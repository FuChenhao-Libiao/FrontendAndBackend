<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰π¶Á≠æÁÆ°ÁêÜÂô®</title>
    <style>
        /* ===== Âü∫Á°ÄÈáçÁΩÆ ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* ===== ËÆæËÆ°ÂèòÈáè ===== */
        :root {
            /* È¢úËâ≤ */
            --bg-body: #F3F4F6;
            --bg-sidebar: #FFFFFF;
            --bg-card: #FFFFFF;
            --bg-hover: #F9FAFB;
            --bg-active: #EFF6FF;
            
            --color-primary: #2563EB;
            --color-primary-hover: #1D4ED8;
            --color-primary-light: #DBEAFE;
            --color-primary-bg: #EFF6FF;
            
            --text-primary: #1F2937;
            --text-secondary: #6B7280;
            --text-tertiary: #9CA3AF;
            
            --border-color: #E5E7EB;
            --border-light: #F3F4F6;
            
            --color-success: #10B981;
            --color-warning: #F59E0B;
            --color-error: #EF4444;
            
            /* Èò¥ÂΩ± */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            
            /* ÂúÜËßí */
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            
            /* ËøáÊ∏° */
            --transition-fast: all 0.15s ease;
            --transition: all 0.2s ease;
            --transition-slow: all 0.3s ease;
            
            /* Â∏ÉÂ±ÄÂ∞∫ÂØ∏ */
            --header-height: 64px;
            --sidebar-width: 260px;
            --sidebar-collapsed-width: 0px;
        }

        /* Ê∑±Ëâ≤‰∏ªÈ¢òÂèòÈáè */
        [data-theme="dark"] {
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-tertiary: #64748b;

            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --bg-hover: #334155;

            --border-color: #334155;
            --border-light: #1e293b;

            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        }

        /* ===== ÂÖ®Â±ÄÊ†∑Âºè ===== */
        html, body {
            height: 100%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 
                         'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: var(--bg-body);
            color: var(--text-primary);
            line-height: 1.5;
            overflow: hidden;
        }

        /* ===== Êï¥‰ΩìÂ∏ÉÂ±Ä ===== */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* È°∂ÈÉ®ÂØºËà™Ê†è */
        .header {
            height: var(--header-height);
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 24px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        /* ‰∏ªÂÜÖÂÆπÂå∫Âüü */
        .main-wrapper {
            display: flex;
            flex: 1;
            margin-top: var(--header-height);
            height: calc(100vh - var(--header-height));
        }

        /* ‰æßËæπÊ†è - ÊµÅÂºèÂ∏ÉÂ±Ä */
        .sidebar {
            width: var(--sidebar-width);
            min-width: var(--sidebar-width);
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
            transition: var(--transition-slow);
        }

        .sidebar.collapsed {
            width: 0;
            min-width: 0;
            border-right: none;
        }

        /* ‰∏ªÂÜÖÂÆπ */
        .main-content {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            transition: var(--transition-slow);
        }

        /* ===== ÊªöÂä®Êù°Ê†∑Âºè ===== */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #D1D5DB;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #9CA3AF;
        }

        /* ===== ÈÄöÁî®ÊåâÈíÆÊ†∑Âºè ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 500;
            border-radius: var(--radius-md);
            border: none;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .btn svg {
            width: 18px;
            height: 18px;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .btn-secondary {
            background: var(--bg-hover);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        .btn-ghost {
            background: transparent;
            color: var(--text-secondary);
        }

        .btn-ghost:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .btn-danger {
            background: var(--color-error);
            color: white;
        }

        .btn-danger:hover {
            background: #DC2626;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }

        .btn-sm svg {
            width: 16px;
            height: 16px;
        }

        .btn-icon {
            padding: 8px;
            border-radius: var(--radius-md);
        }

        /* ===== ËæìÂÖ•Ê°ÜÈÄöÁî®Ê†∑Âºè ===== */
        .input {
            width: 100%;
            height: 40px;
            padding: 0 12px;
            font-size: 14px;
            color: var(--text-primary);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            outline: none;
            transition: var(--transition);
        }

        .input::placeholder {
            color: var(--text-tertiary);
        }

        .input:hover {
            border-color: #D1D5DB;
        }

        .input:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .textarea {
            min-height: 80px;
            padding: 12px;
            resize: vertical;
            line-height: 1.5;
        }

        /* ===== ÈÅÆÁΩ©Â±Ç ===== */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .overlay.show {
            opacity: 1;
            visibility: visible;
        }

        /* ===== ÂºπÁ™óÂü∫Á°ÄÊ†∑Âºè ===== */
        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            z-index: 201;
            width: 90%;
            max-width: 480px;
            max-height: 90vh;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-light);
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            background: transparent;
            color: var(--text-tertiary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .modal-close svg {
            width: 20px;
            height: 20px;
        }

        .modal-body {
            padding: 24px;
            overflow-y: auto;
            max-height: calc(90vh - 140px);
        }

        .modal-footer {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 24px;
            border-top: 1px solid var(--border-light);
            background: var(--bg-hover);
        }

        /* ===== Toast ÊèêÁ§∫ ===== */
        .toast-container {
            position: fixed;
            top: 80px;
            right: 24px;
            z-index: 300;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .toast {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            background: var(--bg-card);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            transform: translateX(120%);
            transition: var(--transition-slow);
            min-width: 280px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .toast.success {
            border-left: 4px solid var(--color-success);
        }

        .toast.success .toast-icon {
            color: var(--color-success);
        }

        .toast.error {
            border-left: 4px solid var(--color-error);
        }

        .toast.error .toast-icon {
            color: var(--color-error);
        }

        .toast.warning {
            border-left: 4px solid var(--color-warning);
        }

        .toast.warning .toast-icon {
            color: var(--color-warning);
        }

        .toast-message {
            flex: 1;
            font-size: 14px;
            color: var(--text-primary);
        }

        /* ===== Âä†ËΩΩÁä∂ÊÄÅ ===== */
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-top-color: var(--color-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== ÂìçÂ∫îÂºèËÆæËÆ° ===== */
        @media (max-width: 1024px) {
            .sidebar {
                position: fixed;
                top: var(--header-height);
                left: 0;
                bottom: 0;
                z-index: 201;
                transform: translateX(-100%);
            }

            .sidebar.show {
                transform: translateX(0);
            }
        }

        @media (max-width: 768px) {
            :root {
                --header-height: 56px;
            }

            .header {
                padding: 0 16px;
            }

            .main-content {
                padding: 16px;
            }

            .modal {
                max-width: calc(100% - 32px);
            }
        }

        /* ============================================
           ‰ª•‰∏ãÂå∫ÂüüÂ∞ÜÂú®ÂêéÁª≠Ê≠•È™§‰∏≠Ê∑ªÂä†ÂÖ∑‰ΩìÁªÑ‰ª∂Ê†∑Âºè
           ============================================ */

        /* ===== STEP 2: È°∂ÈÉ®ÂØºËà™Ê†èÊ†∑Âºè ===== */
        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .menu-toggle {
            display: none;
            width: 40px;
            height: 40px;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
        }

        .menu-toggle:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .menu-toggle svg {
            width: 24px;
            height: 24px;
        }

        @media (max-width: 1024px) {
            .menu-toggle {
                display: flex;
            }
        }

        .header-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
        }

        .header-logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-logo-icon svg {
            width: 20px;
            height: 20px;
            color: white;
        }

        .header-logo-text {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        @media (max-width: 768px) {
            .header-logo-text {
                display: none;
            }
        }

        /* ÊêúÁ¥¢Ê°Ü */
        .header-search {
            flex: 1;
            max-width: 480px;
            margin: 0 32px;
            position: relative;
        }

        .header-search-input {
            width: 100%;
            height: 42px;
            padding: 0 16px 0 44px;
            font-size: 14px;
            color: var(--text-primary);
            background: var(--bg-body);
            border: 1px solid transparent;
            border-radius: 21px;
            outline: none;
            transition: var(--transition);
        }

        .header-search-input::placeholder {
            color: var(--text-tertiary);
        }

        .header-search-input:hover {
            background: var(--bg-hover);
        }

        .header-search-input:focus {
            background: var(--bg-card);
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .header-search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            color: var(--text-tertiary);
            pointer-events: none;
        }

        .header-search-clear {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 28px;
            height: 28px;
            display: none;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: var(--text-tertiary);
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
        }

        .header-search-clear:hover {
            background: var(--border-color);
            color: var(--text-primary);
        }

        .header-search-clear.show {
            display: flex;
        }

        .header-search-clear svg {
            width: 16px;
            height: 16px;
        }

        @media (max-width: 768px) {
            .header-search {
                display: none;
            }
        }

        /* Âè≥‰æßÂå∫Âüü */
        .header-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-add-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
        }

        .header-add-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .header-add-btn svg {
            width: 18px;
            height: 18px;
        }

        @media (max-width: 768px) {
            .header-add-btn span {
                display: none;
            }

            .header-add-btn {
                padding: 10px;
                border-radius: 50%;
            }
        }

        /* Áî®Êà∑ËèúÂçï */
        .user-menu {
            position: relative;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--color-primary-light);
            color: var(--color-primary);
            font-size: 16px;
            font-weight: 600;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .user-avatar:hover {
            border-color: var(--color-primary);
        }

        .user-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            width: 200px;
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border-color);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: var(--transition);
            z-index: 150;
        }

        .user-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .user-dropdown-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-light);
        }

        .user-dropdown-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .user-dropdown-email {
            font-size: 12px;
            color: var(--text-secondary);
            word-break: break-all;
        }

        .user-dropdown-menu {
            padding: 8px;
        }

        .user-dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            padding: 10px 12px;
            font-size: 14px;
            color: var(--text-primary);
            background: transparent;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
            text-align: left;
        }

        .user-dropdown-item:hover {
            background: var(--bg-hover);
        }

        .user-dropdown-item svg {
            width: 18px;
            height: 18px;
            color: var(--text-secondary);
        }

        .user-dropdown-item.danger {
            color: var(--color-error);
        }

        .user-dropdown-item.danger svg {
            color: var(--color-error);
        }

        .user-dropdown-divider {
            height: 1px;
            background: var(--border-light);
            margin: 8px 0;
        }
        
        /* ===== STEP 3: ‰æßËæπÊ†èÊ†∑Âºè ===== */
        .sidebar-header {
            padding: 20px 16px;
            border-bottom: 1px solid var(--border-light);
        }

        .sidebar-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sidebar-nav {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            padding: 12px 16px;
            font-size: 14px;
            color: var(--text-primary);
            background: transparent;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
            text-align: left;
            margin-bottom: 4px;
        }

        .nav-item:hover {
            background: var(--bg-hover);
        }

        .nav-item.active {
            background: var(--color-primary-bg);
            color: var(--color-primary);
        }

        .nav-item-icon {
            font-size: 18px;
            width: 24px;
            text-align: center;
            flex-shrink: 0;
        }

        .nav-item-text {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .nav-item-count {
            font-size: 12px;
            color: var(--text-tertiary);
            background: var(--bg-body);
            padding: 2px 8px;
            border-radius: 10px;
            min-width: 24px;
            text-align: center;
        }

        .nav-item.active .nav-item-count {
            background: var(--color-primary-light);
            color: var(--color-primary);
        }

        .nav-item-actions {
            display: none;
            gap: 4px;
        }

        .nav-item:hover .nav-item-actions {
            display: flex;
        }

        .nav-item:hover .nav-item-count {
            display: none;
        }

        .nav-action-btn {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: var(--text-tertiary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
        }

        .nav-action-btn:hover {
            background: var(--border-color);
            color: var(--text-primary);
        }

        .nav-action-btn svg {
            width: 14px;
            height: 14px;
        }

        /* ÂàÜÂâ≤Á∫ø */
        .nav-divider {
            height: 1px;
            background: var(--border-light);
            margin: 12px 16px;
        }

        /* ===== ÊãñÊãΩÊéíÂ∫èÊ†∑Âºè ===== */
        /* ÂàÜÁ±ªÊãñÊãΩ */
        .nav-item[draggable="true"] {
            cursor: grab;
        }

        .nav-item[draggable="true"]:active {
            cursor: grabbing;
        }

        .nav-item.dragging {
            opacity: 0.5;
            background: var(--bg-hover);
        }

        .nav-item.drag-over {
            border-top: 2px solid var(--color-primary);
            margin-top: -2px;
        }

        .nav-item.drag-target {
            background: var(--color-primary-bg);
            border: 2px dashed var(--color-primary);
        }

        /* ‰π¶Á≠æÊãñÊãΩ */
        .bookmark-card[draggable="true"] {
            cursor: grab;
        }

        .bookmark-card[draggable="true"]:active {
            cursor: grabbing;
        }

        .bookmark-card.dragging {
            opacity: 0.5;
            transform: scale(0.98);
        }

        .bookmark-card.drag-over {
            border: 2px dashed var(--color-primary);
            background: var(--color-primary-bg);
        }

        /* ÊãñÊãΩÂç†‰ΩçÁ¨¶ */
        .drag-placeholder {
            border: 2px dashed var(--color-primary);
            border-radius: var(--radius-lg);
            background: var(--color-primary-bg);
            opacity: 0.5;
        }

        /* Ê∑ªÂä†ÂàÜÁ±ªÊåâÈíÆ */
        .sidebar-footer {
            padding: 16px;
            border-top: 1px solid var(--border-light);
        }

        .add-category-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 12px;
            font-size: 14px;
            font-weight: 500;
            color: var(--color-primary);
            background: var(--color-primary-bg);
            border: 1px dashed var(--color-primary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
        }

        .add-category-btn:hover {
            background: var(--color-primary-light);
        }

        .add-category-btn svg {
            width: 18px;
            height: 18px;
        }

        /* ÁªüËÆ°‰ø°ÊÅØ */
        .sidebar-stats {
            padding: 16px;
            margin: 0 12px 12px;
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-radius: var(--radius-md);
        }

        .stats-title {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .stats-item {
            text-align: center;
        }

        .stats-value {
            font-size: 20px;
            font-weight: 600;
            color: var(--color-primary);
        }

        .stats-label {
            font-size: 11px;
            color: var(--text-tertiary);
        }
        
        /* ===== STEP 4: ‰π¶Á≠æÂç°ÁâáÊ†∑Âºè ===== */
        
        /* ÂÜÖÂÆπÂ§¥ÈÉ® */
        .content-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .content-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .content-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .view-toggle {
            display: flex;
            gap: 4px;
            padding: 4px;
            background: var(--bg-card);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
        }

        .view-toggle-btn {
            width: 36px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: var(--text-tertiary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
        }

        .view-toggle-btn:hover {
            color: var(--text-primary);
        }

        .view-toggle-btn.active {
            background: var(--color-primary);
            color: white;
        }

        .view-toggle-btn svg {
            width: 18px;
            height: 18px;
        }

        /* ‰π¶Á≠æÁΩëÊ†º */
        .bookmarks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .bookmarks-grid.list-view {
            grid-template-columns: 1fr;
            gap: 12px;
        }

        /* ‰π¶Á≠æÂç°Áâá */
        .bookmark-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            padding: 20px;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }

        .bookmark-card:hover {
            border-color: var(--color-primary-light);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .bookmark-card-header {
            display: flex;
            align-items: flex-start;
            gap: 14px;
            margin-bottom: 12px;
        }

        .bookmark-favicon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            background: var(--bg-body);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            overflow: hidden;
        }

        .bookmark-favicon img {
            width: 24px;
            height: 24px;
            object-fit: contain;
        }

        .bookmark-favicon-placeholder {
            font-size: 20px;
        }

        .bookmark-info {
            flex: 1;
            min-width: 0;
        }

        .bookmark-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .bookmark-url {
            font-size: 12px;
            color: var(--text-tertiary);
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
            word-break: break-all;
        }

        .bookmark-actions {
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: var(--transition);
        }

        .bookmark-card:hover .bookmark-actions {
            opacity: 1;
        }

        .bookmark-action-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-body);
            border: none;
            color: var(--text-secondary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
        }

        .bookmark-action-btn:hover {
            background: var(--border-color);
            color: var(--text-primary);
        }

        .bookmark-action-btn.danger:hover {
            background: #FEE2E2;
            color: var(--color-error);
        }

        .bookmark-action-btn svg {
            width: 16px;
            height: 16px;
        }

        .bookmark-description {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            margin-bottom: 16px;
        }

        .bookmark-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-top: 12px;
            border-top: 1px solid var(--border-light);
        }

        .bookmark-category {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--color-primary);
            background: var(--color-primary-bg);
            padding: 4px 10px;
            border-radius: 12px;
        }

        .bookmark-date {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        /* ÂàóË°®ËßÜÂõæÊ†∑Âºè */
        .bookmarks-grid.list-view .bookmark-card {
            padding: 16px 20px;
        }

        .bookmarks-grid.list-view .bookmark-card-header {
            margin-bottom: 0;
        }

        .bookmarks-grid.list-view .bookmark-description,
        .bookmarks-grid.list-view .bookmark-footer {
            display: none;
        }

        .bookmarks-grid.list-view .bookmark-favicon {
            width: 36px;
            height: 36px;
        }

        .bookmarks-grid.list-view .bookmark-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .bookmarks-grid.list-view .bookmark-title {
            margin-bottom: 0;
            flex-shrink: 0;
        }

        .bookmarks-grid.list-view .bookmark-url {
            flex: 1;
        }

        /* Á©∫Áä∂ÊÄÅ */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            text-align: center;
        }

        .empty-state-icon {
            width: 120px;
            height: 120px;
            margin-bottom: 24px;
            color: var(--text-tertiary);
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .empty-state-desc {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        /* Âä†ËΩΩÁä∂ÊÄÅ */
        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
        }

        .loading-state .loading-spinner {
            width: 40px;
            height: 40px;
            margin-bottom: 16px;
        }

        .loading-state-text {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* ÁßªÂä®Á´ØÊêúÁ¥¢Ê°Ü */
        .mobile-search {
            display: none;
            margin-bottom: 20px;
        }

        .mobile-search-input {
            width: 100%;
            height: 44px;
            padding: 0 16px 0 44px;
            font-size: 14px;
            color: var(--text-primary);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            outline: none;
        }

        .mobile-search-input:focus {
            border-color: var(--color-primary);
        }

        .mobile-search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            color: var(--text-tertiary);
        }

        @media (max-width: 768px) {
            .mobile-search {
                display: block;
                position: relative;
            }

            .bookmarks-grid {
                grid-template-columns: 1fr;
            }

            .content-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }
        }
        
        /* ===== STEP 5: ÂºπÁ™óÁªÑ‰ª∂Ê†∑Âºè ===== */
        
        /* Ë°®ÂçïÁªÑ */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .form-label .required {
            color: var(--color-error);
            margin-left: 2px;
        }

        .form-input {
            width: 100%;
            height: 44px;
            padding: 0 14px;
            font-size: 14px;
            color: var(--text-primary);
            background: var(--bg-body);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            outline: none;
            transition: var(--transition);
        }

        .form-input::placeholder {
            color: var(--text-tertiary);
        }

        .form-input:hover {
            border-color: #D1D5DB;
        }

        .form-input:focus {
            border-color: var(--color-primary);
            background: var(--bg-card);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-textarea {
            min-height: 100px;
            padding: 12px 14px;
            resize: vertical;
            line-height: 1.5;
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236B7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 40px;
            cursor: pointer;
        }

        .form-hint {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 6px;
        }

        .form-error {
            font-size: 12px;
            color: var(--color-error);
            margin-top: 6px;
            display: none;
        }

        .form-error.show {
            display: block;
        }

        /* Emoji ÈÄâÊã©Âô® */
        .emoji-picker {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 12px;
            background: var(--bg-body);
            border-radius: var(--radius-md);
            max-height: 120px;
            overflow-y: auto;
        }

        .emoji-item {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: transparent;
            border: 2px solid transparent;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
        }

        .emoji-item:hover {
            background: var(--bg-hover);
        }

        .emoji-item.selected {
            border-color: var(--color-primary);
            background: var(--color-primary-bg);
        }

        /* Á°ÆËÆ§ÂºπÁ™óÊ†∑Âºè */
        .confirm-modal {
            max-width: 400px;
        }

        .confirm-icon {
            width: 56px;
            height: 56px;
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .confirm-icon.warning {
            background: #FEF3C7;
            color: var(--color-warning);
        }

        .confirm-icon.danger {
            background: #FEE2E2;
            color: var(--color-error);
        }

        .confirm-icon svg {
            width: 28px;
            height: 28px;
        }

        .confirm-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            text-align: center;
            margin-bottom: 8px;
        }

        .confirm-message {
            font-size: 14px;
            color: var(--text-secondary);
            text-align: center;
            line-height: 1.6;
        }

        .confirm-footer {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .confirm-footer .btn {
            flex: 1;
        }

    </style>
</head>
<body>
    <div class="app-container">
        <!-- ===== È°∂ÈÉ®ÂØºËà™Ê†è ===== -->
        <header class="header" id="header">
            <!-- Â∑¶‰æßÔºöËèúÂçïÊåâÈíÆ + Logo -->
            <div class="header-left">
                <button class="menu-toggle" id="menuToggle" title="Â±ïÂºÄ/Êî∂Ëµ∑ËèúÂçï">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                <a href="index.html" class="header-logo">
                    <div class="header-logo-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                        </svg>
                    </div>
                    <span class="header-logo-text">‰π¶Á≠æÁÆ°ÁêÜÂô®</span>
                </a>
            </div>

            <!-- ‰∏≠Èó¥ÔºöÊêúÁ¥¢Ê°Ü -->
            <div class="header-search">
                <svg class="header-search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                <input 
                    type="text" 
                    class="header-search-input" 
                    id="searchInput"
                    placeholder="ÊêúÁ¥¢‰π¶Á≠æ..."
                    autocomplete="off"
                >
                <button class="header-search-clear" id="searchClear" title="Ê∏ÖÈô§">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <!-- Âè≥‰æßÔºöÊ∑ªÂä†ÊåâÈíÆ + Áî®Êà∑ËèúÂçï -->
            <div class="header-right">
                <button class="header-add-btn" id="addBookmarkBtn" title="Ê∑ªÂä†‰π¶Á≠æ">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    <span>Ê∑ªÂä†‰π¶Á≠æ</span>
                </button>

                <div class="user-menu" id="userMenu">
                    <div class="user-avatar" id="userAvatar" title="Áî®Êà∑ËèúÂçï">U</div>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="user-dropdown-header">
                            <div class="user-dropdown-name" id="dropdownUserName">Áî®Êà∑</div>
                            <div class="user-dropdown-email" id="dropdownUserEmail">Êú™ËÆæÁΩÆÈÇÆÁÆ±</div>
                        </div>
                        <div class="user-dropdown-menu">
                            <a href="profile.html" class="user-dropdown-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                                ‰∏™‰∫∫ËÆæÁΩÆ
                            </a>
                            <div class="user-dropdown-divider"></div>
                            <button class="user-dropdown-item danger" id="logoutBtn">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                    <polyline points="16 17 21 12 16 7"></polyline>
                                    <line x1="21" y1="12" x2="9" y2="12"></line>
                                </svg>
                                ÈÄÄÂá∫ÁôªÂΩï
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- ===== ‰∏ªÂÜÖÂÆπÂå∫Âüü ===== -->
        <div class="main-wrapper">
            <!-- ‰æßËæπÊ†è -->
            <aside class="sidebar" id="sidebar">
                <!-- ÁªüËÆ°‰ø°ÊÅØ -->
                <div class="sidebar-stats">
                    <div class="stats-title">üìä Êï∞ÊçÆÁªüËÆ°</div>
                    <div class="stats-grid">
                        <div class="stats-item">
                            <div class="stats-value" id="statsTotalBookmarks">0</div>
                            <div class="stats-label">‰π¶Á≠æÊÄªÊï∞</div>
                        </div>
                        <div class="stats-item">
                            <div class="stats-value" id="statsTotalCategories">0</div>
                            <div class="stats-label">ÂàÜÁ±ªÊï∞Èáè</div>
                        </div>
                    </div>
                </div>

                <!-- ÂØºËà™ËèúÂçï -->
                <nav class="sidebar-nav" id="sidebarNav">
                    <!-- ÂÖ®ÈÉ®‰π¶Á≠æ -->
                    <button class="nav-item active" data-category="all">
                        <span class="nav-item-icon">üìö</span>
                        <span class="nav-item-text">ÂÖ®ÈÉ®‰π¶Á≠æ</span>
                        <span class="nav-item-count" id="countAll">0</span>
                    </button>

                    <!-- Êú™ÂàÜÁ±ª -->
                    <button class="nav-item" data-category="uncategorized">
                        <span class="nav-item-icon">üìÅ</span>
                        <span class="nav-item-text">Êú™ÂàÜÁ±ª</span>
                        <span class="nav-item-count" id="countUncategorized">0</span>
                    </button>

                    <div class="nav-divider"></div>

                    <!-- ÂàÜÁ±ªÂàóË°® - Âä®ÊÄÅÁîüÊàê -->
                    <div id="categoryList">
                        <!-- ÂàÜÁ±ªÈ°πÂ∞ÜÈÄöËøá JS Âä®ÊÄÅÊ∑ªÂä† -->
                    </div>
                </nav>

                <!-- Ê∑ªÂä†ÂàÜÁ±ªÊåâÈíÆ -->
                <div class="sidebar-footer">
                    <button class="add-category-btn" id="addCategoryBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Êñ∞Âª∫ÂàÜÁ±ª
                    </button>
                </div>
            </aside>

            <!-- ‰∏ªÂÜÖÂÆπ -->
            <main class="main-content" id="mainContent">
                <!-- ÁßªÂä®Á´ØÊêúÁ¥¢Ê°Ü -->
                <div class="mobile-search">
                    <svg class="mobile-search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <input type="text" class="mobile-search-input" id="mobileSearchInput" placeholder="ÊêúÁ¥¢‰π¶Á≠æ...">
                </div>

                <!-- ÂÜÖÂÆπÂ§¥ÈÉ® -->
                <div class="content-header">
                    <div>
                        <h1 class="content-title" id="contentTitle">ÂÖ®ÈÉ®‰π¶Á≠æ</h1>
                        <p class="content-subtitle" id="contentSubtitle">ÂÖ± 0 ‰∏™‰π¶Á≠æ</p>
                    </div>
                    <div class="view-toggle">
                        <button class="view-toggle-btn active" id="gridViewBtn" title="ÁΩëÊ†ºËßÜÂõæ">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="7" height="7"></rect>
                                <rect x="14" y="3" width="7" height="7"></rect>
                                <rect x="3" y="14" width="7" height="7"></rect>
                                <rect x="14" y="14" width="7" height="7"></rect>
                            </svg>
                        </button>
                        <button class="view-toggle-btn" id="listViewBtn" title="ÂàóË°®ËßÜÂõæ">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="8" y1="6" x2="21" y2="6"></line>
                                <line x1="8" y1="12" x2="21" y2="12"></line>
                                <line x1="8" y1="18" x2="21" y2="18"></line>
                                <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                <line x1="3" y1="18" x2="3.01" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- ‰π¶Á≠æÂàóË°®ÂÆπÂô® -->
                <div class="bookmarks-grid" id="bookmarksGrid">
                    <!-- ‰π¶Á≠æÂç°ÁâáÂ∞ÜÈÄöËøá JS Âä®ÊÄÅÁîüÊàê -->
                </div>

                <!-- Á©∫Áä∂ÊÄÅ -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <svg class="empty-state-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <h3 class="empty-state-title">ËøòÊ≤°Êúâ‰π¶Á≠æ</h3>
                    <p class="empty-state-desc">ÁÇπÂáªÂè≥‰∏äËßíÁöÑ"Ê∑ªÂä†‰π¶Á≠æ"ÊåâÈíÆÂºÄÂßãÊî∂ËóèÁΩëÁ´ô</p>
                    <button class="btn btn-primary" id="emptyAddBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Ê∑ªÂä†Á¨¨‰∏Ä‰∏™‰π¶Á≠æ
                    </button>
                </div>
            </main>
        </div>
    </div>

    <!-- ===== ÈÅÆÁΩ©Â±Ç ===== -->
    <div class="overlay" id="overlay"></div>

    <!-- ===== ÂºπÁ™óÂÆπÂô® ===== -->
    
    <!-- Ê∑ªÂä†/ÁºñËæë‰π¶Á≠æÂºπÁ™ó -->
    <div class="modal" id="bookmarkModal">
        <div class="modal-header">
            <h2 class="modal-title" id="bookmarkModalTitle">Ê∑ªÂä†‰π¶Á≠æ</h2>
            <button class="modal-close" id="bookmarkModalClose">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <form id="bookmarkForm">
                <input type="hidden" id="bookmarkId">
                
                <div class="form-group">
                    <label class="form-label" for="bookmarkUrl">
                        ÁΩëÂùÄ <span class="required">*</span>
                    </label>
                    <input type="url" id="bookmarkUrl" class="form-input" placeholder="https://example.com" required>
                    <div class="form-error" id="bookmarkUrlError">ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÁΩëÂùÄ</div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="bookmarkTitle">
                        Ê†áÈ¢ò <span class="required">*</span>
                    </label>
                    <input type="text" id="bookmarkTitle" class="form-input" placeholder="ÁΩëÁ´ôÊ†áÈ¢ò" maxlength="100" required>
                    <div class="form-error" id="bookmarkTitleError">ËØ∑ËæìÂÖ•Ê†áÈ¢ò</div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="bookmarkDescription">ÊèèËø∞</label>
                    <textarea id="bookmarkDescription" class="form-input form-textarea" placeholder="ÁÆÄÂçïÊèèËø∞‰∏Ä‰∏ãËøô‰∏™ÁΩëÁ´ôÔºàÈÄâÂ°´Ôºâ" maxlength="500"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label" for="bookmarkCategory">ÂàÜÁ±ª</label>
                    <select id="bookmarkCategory" class="form-input form-select">
                        <option value="">Êú™ÂàÜÁ±ª</option>
                        <!-- ÂàÜÁ±ªÈÄâÈ°πÂ∞ÜÂä®ÊÄÅÁîüÊàê -->
                    </select>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="bookmarkCancelBtn">ÂèñÊ∂à</button>
            <button class="btn btn-primary" id="bookmarkSaveBtn">‰øùÂ≠ò</button>
        </div>
    </div>

    <!-- Ê∑ªÂä†/ÁºñËæëÂàÜÁ±ªÂºπÁ™ó -->
    <div class="modal" id="categoryModal">
        <div class="modal-header">
            <h2 class="modal-title" id="categoryModalTitle">Êñ∞Âª∫ÂàÜÁ±ª</h2>
            <button class="modal-close" id="categoryModalClose">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <form id="categoryForm">
                <input type="hidden" id="categoryId">
                
                <div class="form-group">
                    <label class="form-label" for="categoryName">
                        ÂàÜÁ±ªÂêçÁß∞ <span class="required">*</span>
                    </label>
                    <input type="text" id="categoryName" class="form-input" placeholder="ËæìÂÖ•ÂàÜÁ±ªÂêçÁß∞" maxlength="50" required>
                    <div class="form-error" id="categoryNameError">ËØ∑ËæìÂÖ•ÂàÜÁ±ªÂêçÁß∞</div>
                </div>

                <div class="form-group">
                    <label class="form-label">ÈÄâÊã©ÂõæÊ†á</label>
                    <div class="emoji-picker" id="emojiPicker">
                        <button type="button" class="emoji-item selected" data-emoji="üìÇ">üìÇ</button>
                        <button type="button" class="emoji-item" data-emoji="üíº">üíº</button>
                        <button type="button" class="emoji-item" data-emoji="üîß">üîß</button>
                        <button type="button" class="emoji-item" data-emoji="üìö">üìö</button>
                        <button type="button" class="emoji-item" data-emoji="üéÆ">üéÆ</button>
                        <button type="button" class="emoji-item" data-emoji="üé¨">üé¨</button>
                        <button type="button" class="emoji-item" data-emoji="üéµ">üéµ</button>
                        <button type="button" class="emoji-item" data-emoji="üì∞">üì∞</button>
                        <button type="button" class="emoji-item" data-emoji="üõí">üõí</button>
                        <button type="button" class="emoji-item" data-emoji="üí∞">üí∞</button>
                        <button type="button" class="emoji-item" data-emoji="üè†">üè†</button>
                        <button type="button" class="emoji-item" data-emoji="‚úàÔ∏è">‚úàÔ∏è</button>
                        <button type="button" class="emoji-item" data-emoji="üçî">üçî</button>
                        <button type="button" class="emoji-item" data-emoji="‚öΩ">‚öΩ</button>
                        <button type="button" class="emoji-item" data-emoji="üí°">üí°</button>
                        <button type="button" class="emoji-item" data-emoji="üî¨">üî¨</button>
                        <button type="button" class="emoji-item" data-emoji="üé®">üé®</button>
                        <button type="button" class="emoji-item" data-emoji="üì±">üì±</button>
                        <button type="button" class="emoji-item" data-emoji="üíª">üíª</button>
                        <button type="button" class="emoji-item" data-emoji="üåê">üåê</button>
                        <button type="button" class="emoji-item" data-emoji="‚≠ê">‚≠ê</button>
                        <button type="button" class="emoji-item" data-emoji="‚ù§Ô∏è">‚ù§Ô∏è</button>
                        <button type="button" class="emoji-item" data-emoji="üîñ">üîñ</button>
                        <button type="button" class="emoji-item" data-emoji="üìå">üìå</button>
                    </div>
                    <input type="hidden" id="categoryIcon" value="üìÇ">
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="categoryCancelBtn">ÂèñÊ∂à</button>
            <button class="btn btn-primary" id="categorySaveBtn">‰øùÂ≠ò</button>
        </div>
    </div>

    <!-- Á°ÆËÆ§Âà†Èô§ÂºπÁ™ó -->
    <div class="modal confirm-modal" id="confirmModal">
        <div class="modal-body" style="padding: 32px;">
            <div class="confirm-icon danger" id="confirmIcon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="15" y1="9" x2="9" y2="15"></line>
                    <line x1="9" y1="9" x2="15" y2="15"></line>
                </svg>
            </div>
            <h3 class="confirm-title" id="confirmTitle">Á°ÆËÆ§Âà†Èô§Ôºü</h3>
            <p class="confirm-message" id="confirmMessage">Ê≠§Êìç‰ΩúÊó†Ê≥ïÊí§ÈîÄÔºåÁ°ÆÂÆöË¶ÅÂà†Èô§ÂêóÔºü</p>
            <div class="confirm-footer">
                <button class="btn btn-secondary" id="confirmCancelBtn">ÂèñÊ∂à</button>
                <button class="btn btn-danger" id="confirmOkBtn">Âà†Èô§</button>
            </div>
        </div>
    </div>

    <!-- ===== Toast ÂÆπÂô® ===== -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- ÂºïÂÖ• API ÊúçÂä° -->
    <script src="js/api.js"></script>
    <script>
        // ============================================
        // Âü∫Á°ÄÂ∑•ÂÖ∑ÂáΩÊï∞
        // ============================================

        /*
         * ========================================
         * üîß ÂêéÁ´ØÂØπÊé•ËØ¥Êòé (BACKEND INTEGRATION)
         * ========================================
         * 
         * ÂΩìÂâç‰ΩøÁî® localStorage Ê®°ÊãüÂêéÁ´ØÊï∞ÊçÆÂ≠òÂÇ®„ÄÇ
         * ÂêéÁª≠ÂØπÊé•ÁúüÂÆûÂêéÁ´ØÊó∂ÔºåÈúÄË¶ÅÂ∞Ü‰ª•‰∏ãÊìç‰ΩúÊõøÊç¢‰∏∫ API Ë∞ÉÁî®Ôºö
         * 
         * „ÄêÊï∞ÊçÆËØªÂèñ„Äë
         * - localStorage.getItem('bookmarks')  ‚Üí GET /api/bookmarks
         * - localStorage.getItem('categories') ‚Üí GET /api/categories
         * - localStorage.getItem('currentUser') ‚Üí GET /api/auth/me
         * 
         * „ÄêÊï∞ÊçÆÂÜôÂÖ•„Äë
         * - localStorage.setItem('bookmarks', ...) ‚Üí POST/PUT /api/bookmarks
         * - localStorage.setItem('categories', ...) ‚Üí POST/PUT /api/categories
         * 
         * „ÄêÊï∞ÊçÆÂà†Èô§„Äë
         * - ‰ªéÊï∞ÁªÑ‰∏≠ÁßªÈô§Âπ∂ setItem ‚Üí DELETE /api/bookmarks/{id}
         * - ‰ªéÊï∞ÁªÑ‰∏≠ÁßªÈô§Âπ∂ setItem ‚Üí DELETE /api/categories/{id}
         * 
         * „ÄêËÆ§ËØÅÁõ∏ÂÖ≥„Äë
         * - localStorage.getItem('token') ‚Üí ËØ∑Ê±ÇÂ§¥ Authorization: Bearer <token>
         * - localStorage.removeItem('token') ‚Üí POST /api/auth/logout
         * 
         * „ÄêÊéíÂ∫èÁõ∏ÂÖ≥„Äë
         * - reorderCategories() ‚Üí PUT /api/categories/reorder
         * - reorderBookmarks() ‚Üí PUT /api/bookmarks/reorder
         * - moveBookmarkToCategory() ‚Üí PUT /api/bookmarks/{id}/move
         * 
         * Ê≥®ÊÑèÔºöÂØπÊé•ÂêéÈúÄË¶ÅÂ∞ÜÂêåÊ≠•Êìç‰ΩúÊîπ‰∏∫ async/await ÂºÇÊ≠•Êìç‰Ωú
         * ÂèÇËÄÉÔºöAPIÊé•Âè£ÊñáÊ°£.md
         * ========================================
         */

        // DOM ÈÄâÊã©Âô®
        const $ = (selector) => document.querySelector(selector);
        const $$ = (selector) => document.querySelectorAll(selector);

        // ÊòæÁ§∫ Toast ÊèêÁ§∫
        function showToast(message, type = 'success', duration = 3000) {
            const container = $('#toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const iconPaths = {
                success: '<circle cx="12" cy="12" r="10"></circle><path d="M9 12l2 2 4-4"></path>',
                error: '<circle cx="12" cy="12" r="10"></circle><path d="M15 9l-6 6M9 9l6 6"></path>',
                warning: '<circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line>'
            };
            
            toast.innerHTML = `
                <svg class="toast-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    ${iconPaths[type] || iconPaths.success}
                </svg>
                <span class="toast-message">${message}</span>
            `;
            
            container.appendChild(toast);
            
            // Ëß¶ÂèëÂä®Áîª
            requestAnimationFrame(() => {
                toast.classList.add('show');
            });
            
            // Ëá™Âä®ÁßªÈô§
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }

        // ÊòæÁ§∫/ÈöêËóèÈÅÆÁΩ©Â±Ç
        function showOverlay() {
            $('#overlay').classList.add('show');
        }

        function hideOverlay() {
            $('#overlay').classList.remove('show');
        }

        // ÊòæÁ§∫/ÈöêËóèÂºπÁ™ó
        function showModal(modalId) {
            showOverlay();
            $(`#${modalId}`).classList.add('show');
        }

        function hideModal(modalId) {
            hideOverlay();
            $(`#${modalId}`).classList.remove('show');
        }

        // ÂÖ≥Èó≠ÊâÄÊúâÂºπÁ™ó
        function hideAllModals() {
            hideOverlay();
            $$('.modal').forEach(modal => modal.classList.remove('show'));
        }

        // ÁÇπÂáªÈÅÆÁΩ©Â±ÇÂÖ≥Èó≠ÂºπÁ™ó
        $('#overlay').addEventListener('click', hideAllModals);

        // ============================================
        // ÁôªÂΩïÁä∂ÊÄÅÊ£ÄÊü•
        // ============================================
        
        function checkAuth() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = 'login.html';
                return false;
            }
            return true;
        }

        // ============================================
        // ÂêéÁª≠Ê≠•È™§Â∞ÜÊ∑ªÂä†Êõ¥Â§ö JavaScript ‰ª£Á†Å
        // ============================================

        // STEP 2: ÂØºËà™Ê†è‰∫§‰∫í
        // ============================================

        // Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÂπ∂ÊòæÁ§∫
        function loadUserInfo() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            if (currentUser.id) {
                const avatar = $('#userAvatar');
                const dropdownName = $('#dropdownUserName');
                const dropdownEmail = $('#dropdownUserEmail');
                
                // ÊòæÁ§∫Áî®Êà∑Â§¥ÂÉèÔºàemojiÊàñÈ¶ñÂ≠óÊØçÔºâ
                if (currentUser.avatar) {
                    avatar.textContent = currentUser.avatar;
                } else {
                    avatar.textContent = currentUser.username.charAt(0).toUpperCase();
                }
                dropdownName.textContent = currentUser.username;
                dropdownEmail.textContent = currentUser.email || 'Êú™ËÆæÁΩÆÈÇÆÁÆ±';
            }
        }

        // Áî®Êà∑‰∏ãÊãâËèúÂçï
        const userAvatar = $('#userAvatar');
        const userDropdown = $('#userDropdown');

        userAvatar.addEventListener('click', (e) => {
            e.stopPropagation();
            userDropdown.classList.toggle('show');
        });

        // ÁÇπÂáªÂ§ñÈÉ®ÂÖ≥Èó≠‰∏ãÊãâËèúÂçï
        document.addEventListener('click', (e) => {
            if (!$('#userMenu').contains(e.target)) {
                userDropdown.classList.remove('show');
            }
        });

        // ÈÄÄÂá∫ÁôªÂΩï
        $('#logoutBtn').addEventListener('click', () => {
            showLogoutConfirmModal();
        });

        // ÈÄÄÂá∫ÁôªÂΩïÁ°ÆËÆ§ÂºπÁ™ó
        function showLogoutConfirmModal() {
            // ÂàõÂª∫ÂºπÁ™óÈÅÆÁΩ©Â±Ç
            const overlay = document.createElement('div');
            overlay.className = 'overlay show';
            overlay.id = 'logoutModalOverlay';
            document.body.appendChild(overlay);

            // ÂàõÂª∫ÂºπÁ™ó
            const modal = document.createElement('div');
            modal.className = 'modal confirm-modal show';
            modal.id = 'logoutModal';
            modal.innerHTML = `
                <div class="modal-body" style="padding: 32px;">
                    <div class="confirm-icon" style="background: #DBEAFE; color: var(--color-primary);">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                    </div>
                    <h3 class="confirm-title">Á°ÆËÆ§ÈÄÄÂá∫ÁôªÂΩïÔºü</h3>
                    <p class="confirm-message">ÈÄÄÂá∫ÂêéÈúÄË¶ÅÈáçÊñ∞ÁôªÂΩïÊâçËÉΩËÆøÈóÆÊÇ®ÁöÑ‰π¶Á≠æÊï∞ÊçÆ„ÄÇ</p>
                    <div class="confirm-footer">
                        <button class="btn btn-secondary" id="logoutCancelBtn">ÂèñÊ∂à</button>
                        <button class="btn btn-primary" id="logoutConfirmBtn">Á°ÆËÆ§ÈÄÄÂá∫</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // ÂÖ≥Èó≠ÂºπÁ™óÂáΩÊï∞
            const closeModal = () => {
                overlay.remove();
                modal.remove();
            };

            // ÁªëÂÆö‰∫ã‰ª∂
            $('#logoutCancelBtn').addEventListener('click', closeModal);
            overlay.addEventListener('click', closeModal);

            $('#logoutConfirmBtn').addEventListener('click', async () => {
                try {
                    await API.auth.logout();
                } catch (e) {
                    console.log('ÈÄÄÂá∫ÁôªÂΩïAPIË∞ÉÁî®Â§±Ë¥•ÔºåÁªßÁª≠Ê∏ÖÁêÜÊú¨Âú∞Áä∂ÊÄÅ');
                }
                API.clearToken();
                closeModal();
                showToast('Â∑≤ÈÄÄÂá∫ÁôªÂΩï', 'success');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 800);
            });
        }

        // ÊêúÁ¥¢Ê°Ü‰∫§‰∫í
        const searchInput = $('#searchInput');
        const searchClear = $('#searchClear');

        searchInput.addEventListener('input', () => {
            searchClear.classList.toggle('show', searchInput.value.length > 0);
            // ÂÆûÊó∂ÊêúÁ¥¢Ôºå‰ªéÁºìÂ≠òËøáÊª§‰π¶Á≠æ
            renderBookmarksFromCache();
        });

        searchClear.addEventListener('click', () => {
            searchInput.value = '';
            searchClear.classList.remove('show');
            searchInput.focus();
            // Ê∏ÖÁ©∫ÊêúÁ¥¢ÂêéÈáçÊñ∞Ê∏≤ÊüìÂÖ®ÈÉ®‰π¶Á≠æ
            renderBookmarksFromCache();
        });

        // ‰æßËæπÊ†èÂàáÊç¢ÔºàÁßªÂä®Á´ØÔºâ
        const sidebar = $('#sidebar');
        const menuToggle = $('#menuToggle');

        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('show');
            if (sidebar.classList.contains('show')) {
                showOverlay();
            } else {
                hideOverlay();
            }
        });

        // ÁÇπÂáªÈÅÆÁΩ©Â±ÇÂÖ≥Èó≠‰æßËæπÊ†è
        $('#overlay').addEventListener('click', () => {
            sidebar.classList.remove('show');
        });

        // STEP 3: ‰æßËæπÊ†è‰∫§‰∫í
        // ============================================

        let currentCategory = 'all'; // ÂΩìÂâçÈÄâ‰∏≠ÁöÑÂàÜÁ±ª
        let cachedCategories = []; // ÁºìÂ≠òÂàÜÁ±ªÊï∞ÊçÆ
        let cachedBookmarks = []; // ÁºìÂ≠ò‰π¶Á≠æÊï∞ÊçÆ

        // Âä†ËΩΩÊâÄÊúâÊï∞ÊçÆÂà∞ÁºìÂ≠òÔºàÁî®‰∫éÂàùÂßãÂåñÔºâ
        async function loadAllData() {
            try {
                // Âπ∂Ë°åËé∑ÂèñÂàÜÁ±ªÂíå‰π¶Á≠æÊï∞ÊçÆ
                const [categoriesRes, bookmarksRes] = await Promise.all([
                    API.categories.getList(),
                    API.bookmarks.getList({})
                ]);
                
                if (categoriesRes.success && categoriesRes.data) {
                    cachedCategories = categoriesRes.data.list || categoriesRes.data || [];
                }
                if (bookmarksRes.success && bookmarksRes.data) {
                    cachedBookmarks = bookmarksRes.data.list || bookmarksRes.data || [];
                }
            } catch (error) {
                console.error('Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•:', error);
            }
        }

        // Ê∏≤ÊüìÂàÜÁ±ªÂàóË°®Ôºà‰ªéÁºìÂ≠òÊï∞ÊçÆÊ∏≤ÊüìÔºå‰∏çËØ∑Ê±ÇAPIÔºâ
        function renderCategoriesFromCache() {
            // Êåâ sortOrder ÊéíÂ∫èÂàÜÁ±ª
            const categories = [...cachedCategories].sort((a, b) => (a.sortOrder || 0) - (b.sortOrder || 0));
            const bookmarks = cachedBookmarks;
            const categoryList = $('#categoryList');
            
            // ËÆ°ÁÆóÂêÑÂàÜÁ±ªÁöÑ‰π¶Á≠æÊï∞Èáè
            const countMap = {};
            categories.forEach(cat => countMap[cat.id] = 0);
            
            let uncategorizedCount = 0;
            bookmarks.forEach(bookmark => {
                if (bookmark.categoryId && countMap[bookmark.categoryId] !== undefined) {
                    countMap[bookmark.categoryId]++;
                } else {
                    uncategorizedCount++;
                }
            });

            // Êõ¥Êñ∞ÁªüËÆ°Êï∞ÊçÆ
            $('#statsTotalBookmarks').textContent = bookmarks.length;
            $('#statsTotalCategories').textContent = categories.length;
            $('#countAll').textContent = bookmarks.length;
            $('#countUncategorized').textContent = uncategorizedCount;

            // ÁîüÊàêÂàÜÁ±ª HTMLÔºàÊ∑ªÂä† draggable Â±ûÊÄßÊîØÊåÅÊãñÊãΩÊéíÂ∫èÔºâ
            categoryList.innerHTML = categories.map((cat, index) => `
                <button class="nav-item ${currentCategory === cat.id ? 'active' : ''}" data-category="${cat.id}" data-index="${index}" draggable="true">
                    <span class="nav-item-icon">${cat.icon || 'üìÇ'}</span>
                    <span class="nav-item-text">${cat.name}</span>
                    <span class="nav-item-count">${countMap[cat.id] || 0}</span>
                    <div class="nav-item-actions">
                        <button class="nav-action-btn" data-action="edit" data-id="${cat.id}" title="ÁºñËæë">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                        </button>
                        <button class="nav-action-btn" data-action="delete" data-id="${cat.id}" title="Âà†Èô§">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            </svg>
                        </button>
                    </div>
                </button>
            `).join('');

            // ÁªëÂÆöÂàÜÁ±ªÁÇπÂáª‰∫ã‰ª∂
            bindCategoryEvents();
            // ÁªëÂÆöÂàÜÁ±ªÊãñÊãΩ‰∫ã‰ª∂
            bindCategoryDragEvents();
            // ÁªëÂÆöË∑®ÂàÜÁ±ªÊãñÊãΩ‰∫ã‰ª∂ÔºàÂÖÅËÆ∏‰π¶Á≠æÊãñÂà∞ÂàÜÁ±ª‰∏äÔºâ
            bindCategoryDropEvents();
        }

        // Ê∏≤ÊüìÂàÜÁ±ªÂàóË°®ÔºàËé∑ÂèñAPIÊï∞ÊçÆÂêéÊ∏≤ÊüìÔºâ
        async function renderCategories() {
            try {
                const response = await API.categories.getList();
                if (response.success && response.data) {
                    cachedCategories = response.data.list || response.data || [];
                }
            } catch (error) {
                console.error('Ëé∑ÂèñÂàÜÁ±ªÂ§±Ë¥•:', error);
            }

            renderCategoriesFromCache();
        }

        // ÁªëÂÆöÂàÜÁ±ªÁõ∏ÂÖ≥‰∫ã‰ª∂
        function bindCategoryEvents() {
            // ÂàÜÁ±ªÂàáÊç¢
            $$('.nav-item[data-category]').forEach(item => {
                item.addEventListener('click', (e) => {
                    // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÊìç‰ΩúÊåâÈíÆÔºå‰∏çÂàáÊç¢ÂàÜÁ±ª
                    if (e.target.closest('.nav-action-btn')) return;

                    $$('.nav-item').forEach(nav => nav.classList.remove('active'));
                    item.classList.add('active');
                    currentCategory = item.dataset.category;
                    
                    // Ê†πÊçÆÂàÜÁ±ªËøáÊª§‰π¶Á≠æÂàóË°®Ôºà‰ΩøÁî®ÁºìÂ≠òÔºâ
                    renderBookmarksFromCache();

                    // ÁßªÂä®Á´ØÁÇπÂáªÂêéÂÖ≥Èó≠‰æßËæπÊ†è
                    if (window.innerWidth <= 1024) {
                        sidebar.classList.remove('show');
                        hideOverlay();
                    }
                });
            });

            // ÁºñËæë/Âà†Èô§ÂàÜÁ±ª
            $$('.nav-action-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const action = btn.dataset.action;
                    const categoryId = parseInt(btn.dataset.id);

                    if (action === 'edit') {
                        showEditCategoryModal(categoryId);
                    } else if (action === 'delete') {
                        deleteCategory(categoryId);
                    }
                });
            });
        }

        // ===== ÂàÜÁ±ªÊãñÊãΩÊéíÂ∫è =====
        let draggedCategory = null;

        function bindCategoryDragEvents() {
            const categoryItems = $$('#categoryList .nav-item[draggable="true"]');
            
            categoryItems.forEach(item => {
                // ÂºÄÂßãÊãñÊãΩ
                item.addEventListener('dragstart', (e) => {
                    draggedCategory = item;
                    item.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/plain', item.dataset.category);
                    e.dataTransfer.setData('type', 'category');
                });

                // ÊãñÊãΩÁªìÊùü
                item.addEventListener('dragend', () => {
                    item.classList.remove('dragging');
                    draggedCategory = null;
                    // ÁßªÈô§ÊâÄÊúâÊãñÊãΩÊ†∑Âºè
                    $$('.nav-item').forEach(el => {
                        el.classList.remove('drag-over', 'drag-target');
                    });
                });

                // ÊãñÊãΩÁªèËøá
                item.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    if (!draggedCategory || draggedCategory === item) return;
                    
                    e.dataTransfer.dropEffect = 'move';
                    
                    // Ê∏ÖÈô§ÂÖ∂‰ªñÂÖÉÁ¥†ÁöÑÊ†∑Âºè
                    $$('.nav-item').forEach(el => el.classList.remove('drag-over'));
                    item.classList.add('drag-over');
                });

                // ÊãñÊãΩÁ¶ªÂºÄ
                item.addEventListener('dragleave', () => {
                    item.classList.remove('drag-over');
                });

                // ÊîæÁΩÆ
                item.addEventListener('drop', (e) => {
                    e.preventDefault();
                    item.classList.remove('drag-over');
                    
                    if (!draggedCategory || draggedCategory === item) return;
                    
                    // Ëé∑ÂèñÊãñÊãΩÁ±ªÂûã
                    const type = e.dataTransfer.getData('type');
                    
                    if (type === 'category') {
                        // ÂàÜÁ±ªÊéíÂ∫è
                        const fromIndex = parseInt(draggedCategory.dataset.index);
                        const toIndex = parseInt(item.dataset.index);
                        reorderCategories(fromIndex, toIndex);
                    } else if (type === 'bookmark') {
                        // ‰π¶Á≠æË∑®ÂàÜÁ±ªÊãñÊãΩ
                        const bookmarkId = parseInt(e.dataTransfer.getData('text/plain'));
                        const targetCategoryId = parseInt(item.dataset.category);
                        moveBookmarkToCategory(bookmarkId, targetCategoryId);
                    }
                });
            });
        }

        // ÈáçÊñ∞ÊéíÂ∫èÂàÜÁ±ª
        async function reorderCategories(fromIndex, toIndex) {
            if (fromIndex === toIndex) return;
            
            // ÂÖàÊåâ sortOrder ÊéíÂ∫èËé∑ÂèñÂΩìÂâçÈ°∫Â∫è
            const sortedCategories = [...cachedCategories].sort((a, b) => (a.sortOrder || 0) - (b.sortOrder || 0));
            
            // Âú®ÊéíÂ∫èÂêéÁöÑÂàóË°®‰∏≠ÁßªÂä®ÂÖÉÁ¥†
            const [movedCategory] = sortedCategories.splice(fromIndex, 1);
            sortedCategories.splice(toIndex, 0, movedCategory);
            
            // Êõ¥Êñ∞ÁºìÂ≠ò‰∏≠ÁöÑ sortOrder
            sortedCategories.forEach((cat, index) => {
                const cachedIndex = cachedCategories.findIndex(c => c.id === cat.id);
                if (cachedIndex !== -1) {
                    cachedCategories[cachedIndex].sortOrder = index;
                }
            });
            
            // ÂÖàÊ∏≤ÊüìUI
            renderCategoriesFromCache();
            
            // Ë∞ÉÁî®ÂêéÁ´ØAPI‰øùÂ≠òÊéíÂ∫è
            try {
                const categoryIds = sortedCategories.map(c => c.id);
                const response = await API.categories.reorder(categoryIds);
                if (response.success) {
                    showToast('ÂàÜÁ±ªÈ°∫Â∫èÂ∑≤Êõ¥Êñ∞', 'success');
                } else {
                    showToast(response.message || 'ÊéíÂ∫è‰øùÂ≠òÂ§±Ë¥•', 'error');
                    // Â§±Ë¥•Êó∂Âà∑Êñ∞Êï∞ÊçÆ
                    await renderCategories();
                }
            } catch (error) {
                console.error('‰øùÂ≠òÂàÜÁ±ªÊéíÂ∫èÂ§±Ë¥•:', error);
                showToast('ÁΩëÁªúÈîôËØØÔºåÊéíÂ∫èÊú™‰øùÂ≠ò', 'error');
            }
        }

        // ÁßªÂä®‰π¶Á≠æÂà∞ÊåáÂÆöÂàÜÁ±ª
        async function moveBookmarkToCategory(bookmarkId, categoryId) {
            const bookmark = cachedBookmarks.find(b => b.id === bookmarkId);
            
            if (!bookmark) return;
            
            try {
                // Ë∞ÉÁî®APIÁßªÂä®‰π¶Á≠æ
                const response = await API.bookmarks.move(bookmarkId, categoryId);
                
                if (response.success) {
                    // ÈáçÊñ∞Ëé∑ÂèñÊï∞ÊçÆÂπ∂Ê∏≤Êüì
                    await loadAllData();
                    renderCategoriesFromCache();
                    renderBookmarksFromCache();
                    
                    const category = cachedCategories.find(c => c.id === categoryId);
                    showToast(`Â∑≤ÁßªÂä®Âà∞ "${category ? category.name : 'Êú™ÂàÜÁ±ª'}"`, 'success');
                } else {
                    showToast(response.message || 'ÁßªÂä®Â§±Ë¥•', 'error');
                }
            } catch (error) {
                console.error('ÁßªÂä®‰π¶Á≠æÂ§±Ë¥•:', error);
                showToast('ÁΩëÁªúÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï', 'error');
            }
        }

        // STEP 4: ‰π¶Á≠æÂàóË°®‰∫§‰∫í
        // ============================================

        let viewMode = 'grid'; // 'grid' or 'list'

        // Ê∏≤Êüì‰π¶Á≠æÂàóË°®Ôºà‰ªéÁºìÂ≠òÊï∞ÊçÆÊ∏≤ÊüìÔºå‰∏çËØ∑Ê±ÇAPIÔºâ
        function renderBookmarksFromCache() {
            const bookmarks = cachedBookmarks;
            const categories = cachedCategories;
            const bookmarksGrid = $('#bookmarksGrid');
            const emptyState = $('#emptyState');

            // Êú¨Âú∞ÊêúÁ¥¢ËøáÊª§
            const searchKeyword = ($('#searchInput')?.value || '').toLowerCase().trim();
            let filteredBookmarks = [...bookmarks]; // ÂàõÂª∫ÂâØÊú¨ÈÅøÂÖç‰øÆÊîπÂéüÊï∞ÁªÑ
            
            // ÊåâÂàÜÁ±ªËøáÊª§
            if (currentCategory === 'uncategorized') {
                filteredBookmarks = filteredBookmarks.filter(b => !b.categoryId);
            } else if (currentCategory !== 'all') {
                filteredBookmarks = filteredBookmarks.filter(b => b.categoryId == currentCategory);
            }
            
            // ÊåâÂÖ≥ÈîÆËØçËøáÊª§
            if (searchKeyword) {
                filteredBookmarks = filteredBookmarks.filter(b => 
                    b.title.toLowerCase().includes(searchKeyword) || 
                    (b.description && b.description.toLowerCase().includes(searchKeyword))
                );
            }
            
            // Êåâ sortOrder ÊéíÂ∫è
            filteredBookmarks.sort((a, b) => (a.sortOrder || 0) - (b.sortOrder || 0));

            // Êõ¥Êñ∞Ê†áÈ¢ò
            updateContentTitle();

            // ÊòæÁ§∫Á©∫Áä∂ÊÄÅÊàñ‰π¶Á≠æÂàóË°®
            if (filteredBookmarks.length === 0) {
                bookmarksGrid.style.display = 'none';
                emptyState.style.display = 'flex';
                // Âç≥‰ΩøÊ≤°Êúâ‰π¶Á≠æÔºå‰πüË¶ÅÁªëÂÆöË∑®ÂàÜÁ±ªÊãñÊãΩ‰∫ã‰ª∂
                bindCategoryDropEvents();
                return;
            }

            bookmarksGrid.style.display = 'grid';
            emptyState.style.display = 'none';

            // ÁîüÊàê‰π¶Á≠æÂç°Áâá HTMLÔºàÊ∑ªÂä† draggable Â±ûÊÄßÊîØÊåÅÊãñÊãΩÊéíÂ∫èÔºâ
            bookmarksGrid.innerHTML = filteredBookmarks.map((bookmark, index) => {
                const category = categories.find(c => c.id === bookmark.categoryId);
                const faviconUrl = bookmark.favicon || `https://www.google.com/s2/favicons?domain=${encodeURIComponent(bookmark.url)}&sz=64`;
                const dateStr = new Date(bookmark.createdAt).toLocaleDateString('zh-CN');

                return `
                    <div class="bookmark-card" data-id="${bookmark.id}" data-url="${bookmark.url}" data-index="${index}" draggable="true">
                        <div class="bookmark-card-header">
                            <div class="bookmark-favicon">
                                <img src="${faviconUrl}" alt="" onerror="this.style.display='none';this.nextElementSibling.style.display='block';">
                                <span class="bookmark-favicon-placeholder" style="display:none;">üîñ</span>
                            </div>
                            <div class="bookmark-info">
                                <h3 class="bookmark-title">${escapeHtml(bookmark.title)}</h3>
                                <p class="bookmark-url">${escapeHtml(bookmark.url)}</p>
                            </div>
                            <div class="bookmark-actions">
                                <button class="bookmark-action-btn" data-action="edit" data-id="${bookmark.id}" title="ÁºñËæë">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                                <button class="bookmark-action-btn danger" data-action="delete" data-id="${bookmark.id}" title="Âà†Èô§">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <p class="bookmark-description">${escapeHtml(bookmark.description || 'ÊöÇÊó†ÊèèËø∞')}</p>
                        <div class="bookmark-footer">
                            <span class="bookmark-category">${category ? category.icon + ' ' + category.name : 'üìÅ Êú™ÂàÜÁ±ª'}</span>
                            <span class="bookmark-date">${dateStr}</span>
                        </div>
                    </div>
                `;
            }).join('');

            // ÁªëÂÆö‰π¶Á≠æ‰∫ã‰ª∂
            bindBookmarkEvents();
        }

        // Ê∏≤Êüì‰π¶Á≠æÂàóË°®ÔºàËé∑ÂèñAPIÊï∞ÊçÆÂêéÊ∏≤ÊüìÔºâ
        async function renderBookmarks() {
            // ÊûÑÂª∫ËØ∑Ê±ÇÂèÇÊï∞
            const params = {};
            
            const searchKeyword = ($('#searchInput')?.value || '').toLowerCase().trim();
            if (searchKeyword) {
                params.keyword = searchKeyword;
            }

            try {
                const response = await API.bookmarks.getList(params);
                if (response.success && response.data) {
                    cachedBookmarks = response.data.list || response.data || [];
                }
            } catch (error) {
                console.error('Ëé∑Âèñ‰π¶Á≠æÂ§±Ë¥•:', error);
            }

            renderBookmarksFromCache();
        }

        // Êõ¥Êñ∞ÂÜÖÂÆπÊ†áÈ¢ò
        function updateContentTitle() {
            const bookmarks = cachedBookmarks;
            const categories = cachedCategories;
            
            let title = 'ÂÖ®ÈÉ®‰π¶Á≠æ';
            let count = bookmarks.length;

            if (currentCategory === 'uncategorized') {
                title = 'Êú™ÂàÜÁ±ª';
                count = bookmarks.filter(b => !b.categoryId).length;
            } else if (currentCategory !== 'all') {
                const category = categories.find(c => c.id === parseInt(currentCategory));
                if (category) {
                    title = category.icon + ' ' + category.name;
                    count = bookmarks.filter(b => b.categoryId === parseInt(currentCategory)).length;
                }
            }

            $('#contentTitle').textContent = title;
            $('#contentSubtitle').textContent = `ÂÖ± ${count} ‰∏™‰π¶Á≠æ`;
        }

        // HTML ËΩ¨‰πâ
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ÁªëÂÆö‰π¶Á≠æÁõ∏ÂÖ≥‰∫ã‰ª∂
        function bindBookmarkEvents() {
            // ÁÇπÂáªÂç°ÁâáÊâìÂºÄÈìæÊé•
            $$('.bookmark-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    if (e.target.closest('.bookmark-action-btn')) return;
                    // ÊãñÊãΩÊó∂‰∏çÊâìÂºÄÈìæÊé•
                    if (card.classList.contains('dragging')) return;
                    const url = card.dataset.url;
                    window.open(url, '_blank');
                });
            });

            // ÁºñËæë/Âà†Èô§‰π¶Á≠æ
            $$('.bookmark-action-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const action = btn.dataset.action;
                    const bookmarkId = parseInt(btn.dataset.id);

                    if (action === 'edit') {
                        showEditBookmarkModal(bookmarkId);
                    } else if (action === 'delete') {
                        deleteBookmark(bookmarkId);
                    }
                });
            });

            // ÁªëÂÆö‰π¶Á≠æÊãñÊãΩ‰∫ã‰ª∂
            bindBookmarkDragEvents();
        }

        // ===== ‰π¶Á≠æÊãñÊãΩÊéíÂ∫è =====
        let draggedBookmark = null;

        function bindBookmarkDragEvents() {
            const bookmarkCards = $$('.bookmark-card[draggable="true"]');
            
            bookmarkCards.forEach(card => {
                // ÂºÄÂßãÊãñÊãΩ
                card.addEventListener('dragstart', (e) => {
                    draggedBookmark = card;
                    card.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/plain', card.dataset.id);
                    e.dataTransfer.setData('type', 'bookmark');
                    
                    // Âª∂ËøüÊ∑ªÂä†ÈÄèÊòéÊïàÊûúÔºåËÆ©ÊãñÊãΩÈ¢ÑËßàÊ≠£Â∏∏ÊòæÁ§∫
                    setTimeout(() => {
                        card.style.opacity = '0.5';
                    }, 0);
                });

                // ÊãñÊãΩÁªìÊùü
                card.addEventListener('dragend', () => {
                    card.classList.remove('dragging');
                    card.style.opacity = '';
                    draggedBookmark = null;
                    // ÁßªÈô§ÊâÄÊúâÊãñÊãΩÊ†∑Âºè
                    $$('.bookmark-card').forEach(el => {
                        el.classList.remove('drag-over');
                    });
                    $$('.nav-item').forEach(el => {
                        el.classList.remove('drag-target');
                    });
                });

                // ÊãñÊãΩÁªèËøá
                card.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    if (!draggedBookmark || draggedBookmark === card) return;
                    
                    e.dataTransfer.dropEffect = 'move';
                    
                    // Ê∏ÖÈô§ÂÖ∂‰ªñÂÖÉÁ¥†ÁöÑÊ†∑Âºè
                    $$('.bookmark-card').forEach(el => el.classList.remove('drag-over'));
                    card.classList.add('drag-over');
                });

                // ÊãñÊãΩÁ¶ªÂºÄ
                card.addEventListener('dragleave', () => {
                    card.classList.remove('drag-over');
                });

                // ÊîæÁΩÆ
                card.addEventListener('drop', (e) => {
                    e.preventDefault();
                    card.classList.remove('drag-over');
                    
                    if (!draggedBookmark || draggedBookmark === card) return;
                    
                    // ‰π¶Á≠æÊéíÂ∫è
                    const fromId = parseInt(draggedBookmark.dataset.id);
                    const toId = parseInt(card.dataset.id);
                    reorderBookmarks(fromId, toId);
                });
            });

            // ‰∏∫ÂàÜÁ±ªÊ∑ªÂä†‰π¶Á≠æÊîæÁΩÆÊîØÊåÅÔºàË∑®ÂàÜÁ±ªÊãñÊãΩÔºâ
            bindCategoryDropEvents();
        }

        // ‰∏∫ÂàÜÁ±ªÊ∑ªÂä†‰π¶Á≠æÊîæÁΩÆ‰∫ã‰ª∂ÔºàË∑®ÂàÜÁ±ªÊãñÊãΩÔºâ
        function bindCategoryDropEvents() {
            // ÂåÖÊã¨Âõ∫ÂÆöÂàÜÁ±ªÂíåÂä®ÊÄÅÂàÜÁ±ª
            const allCategoryItems = $$('.nav-item[data-category]');
            
            allCategoryItems.forEach(item => {
                item.addEventListener('dragover', (e) => {
                    // Âè™Êé•Âèó‰π¶Á≠æÊãñÊãΩ
                    if (!draggedBookmark) return;
                    
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    
                    // Ê∏ÖÈô§ÂÖ∂‰ªñÂàÜÁ±ªÁöÑÊ†∑Âºè
                    $$('.nav-item').forEach(el => el.classList.remove('drag-target'));
                    item.classList.add('drag-target');
                });

                item.addEventListener('dragleave', () => {
                    item.classList.remove('drag-target');
                });

                item.addEventListener('drop', (e) => {
                    if (!draggedBookmark) return;
                    
                    e.preventDefault();
                    item.classList.remove('drag-target');
                    
                    const bookmarkId = parseInt(draggedBookmark.dataset.id);
                    const targetCategory = item.dataset.category;
                    
                    // Á°ÆÂÆöÁõÆÊ†áÂàÜÁ±ª ID
                    let targetCategoryId = null;
                    if (targetCategory === 'uncategorized') {
                        targetCategoryId = null; // ËÆæ‰∏∫Êú™ÂàÜÁ±ª
                    } else if (targetCategory !== 'all') {
                        targetCategoryId = parseInt(targetCategory);
                    } else {
                        // ÊãñÂà∞"ÂÖ®ÈÉ®‰π¶Á≠æ"‰∏çÂÅöÂ§ÑÁêÜ
                        return;
                    }
                    
                    moveBookmarkToCategory(bookmarkId, targetCategoryId);
                });
            });
        }

        // ÈáçÊñ∞ÊéíÂ∫è‰π¶Á≠æ
        async function reorderBookmarks(fromId, toId) {
            // Ëé∑ÂèñÂΩìÂâçÊòæÁ§∫ÁöÑ‰π¶Á≠æÂàóË°®ÔºàËøáÊª§ÂêéÁöÑÔºâ
            let displayedBookmarks = [...cachedBookmarks];
            
            // ÊåâÂΩìÂâçÂàÜÁ±ªËøáÊª§
            if (currentCategory === 'uncategorized') {
                displayedBookmarks = displayedBookmarks.filter(b => !b.categoryId);
            } else if (currentCategory !== 'all') {
                displayedBookmarks = displayedBookmarks.filter(b => b.categoryId == currentCategory);
            }
            
            const fromIndex = displayedBookmarks.findIndex(b => b.id === fromId);
            const toIndex = displayedBookmarks.findIndex(b => b.id === toId);
            
            if (fromIndex === -1 || toIndex === -1 || fromIndex === toIndex) return;
            
            // Âú®ËøáÊª§ÂêéÁöÑÂàóË°®‰∏≠ÁßªÂä®ÂÖÉÁ¥†
            const [movedBookmark] = displayedBookmarks.splice(fromIndex, 1);
            displayedBookmarks.splice(toIndex, 0, movedBookmark);
            
            // Êõ¥Êñ∞ÁºìÂ≠ò‰∏≠ÂØπÂ∫î‰π¶Á≠æÁöÑÈ°∫Â∫è
            displayedBookmarks.forEach((b, index) => {
                const cachedIndex = cachedBookmarks.findIndex(cb => cb.id === b.id);
                if (cachedIndex !== -1) {
                    cachedBookmarks[cachedIndex].sortOrder = index;
                }
            });
            
            // ÈáçÊñ∞Êåâ sortOrder ÊéíÂ∫èÁºìÂ≠ò
            cachedBookmarks.sort((a, b) => (a.sortOrder || 0) - (b.sortOrder || 0));
            
            // ÂÖàÊ∏≤ÊüìUI
            renderBookmarksFromCache();
            
            // Ë∞ÉÁî®ÂêéÁ´ØAPI‰øùÂ≠òÊéíÂ∫èÔºàÂè™ÂèëÈÄÅÂΩìÂâçÂàÜÁ±ªÁöÑ‰π¶Á≠æIDÈ°∫Â∫èÔºâ
            try {
                const bookmarkIds = displayedBookmarks.map(b => b.id);
                const categoryId = currentCategory !== 'all' && currentCategory !== 'uncategorized' 
                    ? parseInt(currentCategory) 
                    : null;
                const response = await API.bookmarks.reorder(bookmarkIds, categoryId);
                if (response.success) {
                    showToast('‰π¶Á≠æÈ°∫Â∫èÂ∑≤Êõ¥Êñ∞', 'success');
                } else {
                    showToast(response.message || 'ÊéíÂ∫è‰øùÂ≠òÂ§±Ë¥•', 'error');
                    // Â§±Ë¥•Êó∂Âà∑Êñ∞Êï∞ÊçÆ
                    await renderBookmarks();
                }
            } catch (error) {
                console.error('‰øùÂ≠ò‰π¶Á≠æÊéíÂ∫èÂ§±Ë¥•:', error);
                showToast('ÁΩëÁªúÈîôËØØÔºåÊéíÂ∫èÊú™‰øùÂ≠ò', 'error');
            }
        }

        // ËßÜÂõæÂàáÊç¢
        $('#gridViewBtn').addEventListener('click', () => {
            viewMode = 'grid';
            $('#gridViewBtn').classList.add('active');
            $('#listViewBtn').classList.remove('active');
            $('#bookmarksGrid').classList.remove('list-view');
        });

        $('#listViewBtn').addEventListener('click', () => {
            viewMode = 'list';
            $('#listViewBtn').classList.add('active');
            $('#gridViewBtn').classList.remove('active');
            $('#bookmarksGrid').classList.add('list-view');
        });

        // Á©∫Áä∂ÊÄÅÊ∑ªÂä†ÊåâÈíÆÔºà‰∫ã‰ª∂Âú® STEP 5 ÁªëÂÆöÔºâ

        // ========================================
        // STEP 5: ÂºπÁ™ó‰∫§‰∫í
        // ========================================

        // ÂºπÁ™óÈÅÆÁΩ©Â±Ç
        const modalOverlay = document.createElement('div');
        modalOverlay.className = 'modal-overlay';
        document.body.appendChild(modalOverlay);

        // ÂºπÁ™óÂÖÉÁ¥†
        const bookmarkModal = $('#bookmarkModal');
        const categoryModal = $('#categoryModal');
        const confirmModal = $('#confirmModal');

        // ÂΩìÂâçÁºñËæëÁöÑÊï∞ÊçÆ
        let editingBookmarkId = null;
        let editingCategoryId = null;
        let confirmCallback = null;

        // ÊâìÂºÄÂºπÁ™óÈÄöÁî®ÊñπÊ≥ï
        function openModal(modal) {
            modalOverlay.classList.add('show');
            modal.classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        // ÂÖ≥Èó≠ÂºπÁ™óÈÄöÁî®ÊñπÊ≥ï
        function closeModal(modal) {
            modalOverlay.classList.remove('show');
            modal.classList.remove('show');
            document.body.style.overflow = '';
        }

        // ÂÖ≥Èó≠ÊâÄÊúâÂºπÁ™ó
        function closeAllModals() {
            modalOverlay.classList.remove('show');
            [bookmarkModal, categoryModal, confirmModal].forEach(m => m.classList.remove('show'));
            document.body.style.overflow = '';
        }

        // ÁÇπÂáªÈÅÆÁΩ©Â±ÇÂÖ≥Èó≠ÂºπÁ™ó
        modalOverlay.addEventListener('click', closeAllModals);

        // ESC ÈîÆÂÖ≥Èó≠ÂºπÁ™ó
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeAllModals();
            }
        });

        // ========== ‰π¶Á≠æÂºπÁ™ó ==========

        // ÊâìÂºÄÊ∑ªÂä†‰π¶Á≠æÂºπÁ™ó
        function showAddBookmarkModal() {
            editingBookmarkId = null;
            $('#bookmarkModalTitle').textContent = 'Ê∑ªÂä†‰π¶Á≠æ';
            $('#bookmarkForm').reset();
            $('#bookmarkId').value = '';
            updateCategoryOptions();
            clearFormErrors();
            openModal(bookmarkModal);
            $('#bookmarkUrl').focus();
        }

        // ÊâìÂºÄÁºñËæë‰π¶Á≠æÂºπÁ™ó
        function showEditBookmarkModal(bookmarkId) {
            // ‰ΩøÁî®ÁºìÂ≠òÁöÑ‰π¶Á≠æÊï∞ÊçÆ
            const bookmark = cachedBookmarks.find(b => b.id === bookmarkId);
            if (!bookmark) return;

            editingBookmarkId = bookmarkId;
            $('#bookmarkModalTitle').textContent = 'ÁºñËæë‰π¶Á≠æ';
            $('#bookmarkId').value = bookmarkId;
            $('#bookmarkUrl').value = bookmark.url;
            $('#bookmarkTitle').value = bookmark.title;
            $('#bookmarkDescription').value = bookmark.description || '';
            updateCategoryOptions();
            $('#bookmarkCategory').value = bookmark.categoryId || '';
            clearFormErrors();
            openModal(bookmarkModal);
            $('#bookmarkTitle').focus();
        }

        // Êõ¥Êñ∞ÂàÜÁ±ª‰∏ãÊãâÈÄâÈ°π
        function updateCategoryOptions() {
            // ‰ΩøÁî®ÁºìÂ≠òÁöÑÂàÜÁ±ªÊï∞ÊçÆ
            const select = $('#bookmarkCategory');
            select.innerHTML = '<option value="">Êú™ÂàÜÁ±ª</option>';
            cachedCategories.forEach(cat => {
                select.innerHTML += `<option value="${cat.id}">${cat.icon} ${cat.name}</option>`;
            });
        }

        // Ê∏ÖÈô§Ë°®ÂçïÈîôËØØ
        function clearFormErrors() {
            $$('.form-group').forEach(group => group.classList.remove('error'));
        }

        // ‰øùÂ≠ò‰π¶Á≠æ
        async function saveBookmark() {
            const url = $('#bookmarkUrl').value.trim();
            const title = $('#bookmarkTitle').value.trim();
            const description = $('#bookmarkDescription').value.trim();
            const categoryId = $('#bookmarkCategory').value;

            // È™åËØÅ
            let hasError = false;

            if (!url || !isValidUrl(url)) {
                $('#bookmarkUrl').closest('.form-group').classList.add('error');
                hasError = true;
            }

            if (!title) {
                $('#bookmarkTitle').closest('.form-group').classList.add('error');
                hasError = true;
            }

            if (hasError) {
                showToast('ËØ∑Ê£ÄÊü•ËæìÂÖ•ÂÜÖÂÆπ', 'error');
                return;
            }

            const bookmarkData = {
                url,
                title,
                description,
                categoryId: categoryId ? parseInt(categoryId) : null
            };

            try {
                let response;
                if (editingBookmarkId) {
                    // ÁºñËæëÁé∞Êúâ‰π¶Á≠æ
                    response = await API.bookmarks.update(editingBookmarkId, bookmarkData);
                    if (response.success) {
                        showToast('‰π¶Á≠æÂ∑≤Êõ¥Êñ∞', 'success');
                    } else {
                        showToast(response.message || 'Êõ¥Êñ∞Â§±Ë¥•', 'error');
                        return;
                    }
                } else {
                    // Ê∑ªÂä†Êñ∞‰π¶Á≠æ
                    response = await API.bookmarks.create(bookmarkData);
                    if (response.success) {
                        showToast('‰π¶Á≠æÂ∑≤Ê∑ªÂä†', 'success');
                    } else {
                        showToast(response.message || 'Ê∑ªÂä†Â§±Ë¥•', 'error');
                        return;
                    }
                }

                closeModal(bookmarkModal);
                await renderBookmarks();
                await renderCategories();
            } catch (error) {
                console.error('‰øùÂ≠ò‰π¶Á≠æÂ§±Ë¥•:', error);
                showToast('ÁΩëÁªúÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï', 'error');
            }
        }

        // È™åËØÅ URL
        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        // Ëé∑ÂèñÁΩëÁ´ôÂõæÊ†á
        function getFaviconUrl(url) {
            try {
                const domain = new URL(url).hostname;
                return `https://www.google.com/s2/favicons?domain=${domain}&sz=64`;
            } catch {
                return null;
            }
        }

        // Âà†Èô§‰π¶Á≠æ
        function deleteBookmark(bookmarkId) {
            showConfirmModal('Á°ÆËÆ§Âà†Èô§‰π¶Á≠æÔºü', 'Ê≠§Êìç‰ΩúÊó†Ê≥ïÊí§ÈîÄÔºåÂà†Èô§Âêé‰π¶Á≠æÂ∞ÜÊ∞∏‰πÖ‰∏¢Â§±„ÄÇ', async () => {
                try {
                    const response = await API.bookmarks.delete(bookmarkId);
                    if (response.success) {
                        showToast('‰π¶Á≠æÂ∑≤Âà†Èô§', 'success');
                        await renderBookmarks();
                        await renderCategories();
                    } else {
                        showToast(response.message || 'Âà†Èô§Â§±Ë¥•', 'error');
                    }
                } catch (error) {
                    console.error('Âà†Èô§‰π¶Á≠æÂ§±Ë¥•:', error);
                    showToast('ÁΩëÁªúÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï', 'error');
                }
            });
        }

        // ‰π¶Á≠æÂºπÁ™ó‰∫ã‰ª∂ÁªëÂÆö
        $('#addBookmarkBtn').addEventListener('click', showAddBookmarkModal);
        $('#emptyAddBtn').addEventListener('click', showAddBookmarkModal);
        $('#bookmarkModalClose').addEventListener('click', () => closeModal(bookmarkModal));
        $('#bookmarkCancelBtn').addEventListener('click', () => closeModal(bookmarkModal));
        $('#bookmarkSaveBtn').addEventListener('click', saveBookmark);

        // ËæìÂÖ•Êó∂Ê∏ÖÈô§ÈîôËØØÁä∂ÊÄÅ
        $$('#bookmarkForm .form-input').forEach(input => {
            input.addEventListener('input', () => {
                input.closest('.form-group').classList.remove('error');
            });
        });

        // ========== ÂàÜÁ±ªÂºπÁ™ó ==========

        // ÊâìÂºÄÊ∑ªÂä†ÂàÜÁ±ªÂºπÁ™ó
        function showAddCategoryModal() {
            editingCategoryId = null;
            $('#categoryModalTitle').textContent = 'Êñ∞Âª∫ÂàÜÁ±ª';
            $('#categoryForm').reset();
            $('#categoryId').value = '';
            $('#categoryIcon').value = 'üìÇ';
            resetEmojiPicker();
            clearFormErrors();
            openModal(categoryModal);
            $('#categoryName').focus();
        }

        // ÊâìÂºÄÁºñËæëÂàÜÁ±ªÂºπÁ™ó
        function showEditCategoryModal(categoryId) {
            // ‰ΩøÁî®ÁºìÂ≠òÁöÑÂàÜÁ±ªÊï∞ÊçÆ
            const category = cachedCategories.find(c => c.id === categoryId);
            if (!category) return;

            editingCategoryId = categoryId;
            $('#categoryModalTitle').textContent = 'ÁºñËæëÂàÜÁ±ª';
            $('#categoryId').value = categoryId;
            $('#categoryName').value = category.name;
            $('#categoryIcon').value = category.icon;
            selectEmoji(category.icon);
            clearFormErrors();
            openModal(categoryModal);
            $('#categoryName').focus();
        }

        // ÈáçÁΩÆË°®ÊÉÖÈÄâÊã©Âô®
        function resetEmojiPicker() {
            $$('#emojiPicker .emoji-item').forEach(item => {
                item.classList.toggle('selected', item.dataset.emoji === 'üìÇ');
            });
        }

        // ÈÄâÊã©Ë°®ÊÉÖ
        function selectEmoji(emoji) {
            $$('#emojiPicker .emoji-item').forEach(item => {
                item.classList.toggle('selected', item.dataset.emoji === emoji);
            });
            $('#categoryIcon').value = emoji;
        }

        // Ë°®ÊÉÖÈÄâÊã©Âô®‰∫ã‰ª∂
        $$('#emojiPicker .emoji-item').forEach(item => {
            item.addEventListener('click', () => {
                selectEmoji(item.dataset.emoji);
            });
        });

        // ‰øùÂ≠òÂàÜÁ±ª
        async function saveCategory() {
            const name = $('#categoryName').value.trim();
            const icon = $('#categoryIcon').value;

            if (!name) {
                $('#categoryName').closest('.form-group').classList.add('error');
                showToast('ËØ∑ËæìÂÖ•ÂàÜÁ±ªÂêçÁß∞', 'error');
                return;
            }

            const categoryData = { name, icon };

            try {
                let response;
                if (editingCategoryId) {
                    // ÁºñËæëÁé∞ÊúâÂàÜÁ±ª
                    response = await API.categories.update(editingCategoryId, categoryData);
                    if (response.success) {
                        showToast('ÂàÜÁ±ªÂ∑≤Êõ¥Êñ∞', 'success');
                    } else {
                        showToast(response.message || 'Êõ¥Êñ∞Â§±Ë¥•', 'error');
                        return;
                    }
                } else {
                    // Ê∑ªÂä†Êñ∞ÂàÜÁ±ª
                    response = await API.categories.create(categoryData);
                    if (response.success) {
                        showToast('ÂàÜÁ±ªÂ∑≤ÂàõÂª∫', 'success');
                    } else {
                        showToast(response.message || 'ÂàõÂª∫Â§±Ë¥•', 'error');
                        return;
                    }
                }

                closeModal(categoryModal);
                await renderCategories();
                await renderBookmarks();
            } catch (error) {
                console.error('‰øùÂ≠òÂàÜÁ±ªÂ§±Ë¥•:', error);
                showToast('ÁΩëÁªúÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï', 'error');
            }
        }

        // Âà†Èô§ÂàÜÁ±ª
        function deleteCategory(categoryId) {
            // ‰ΩøÁî®ÁºìÂ≠òÁöÑ‰π¶Á≠æÊï∞ÊçÆÊ£ÄÊü•
            const hasBookmarks = cachedBookmarks.some(b => b.categoryId === categoryId);

            let message = 'Âà†Èô§ÂêéËØ•ÂàÜÁ±ªÂ∞ÜÊ∞∏‰πÖ‰∏¢Â§±„ÄÇ';
            if (hasBookmarks) {
                message = 'ËØ•ÂàÜÁ±ª‰∏ãËøòÊúâ‰π¶Á≠æÔºåÂà†Èô§ÂêéËøô‰∫õ‰π¶Á≠æÂ∞ÜÂèò‰∏∫"Êú™ÂàÜÁ±ª"„ÄÇ';
            }

            showConfirmModal('Á°ÆËÆ§Âà†Èô§ÂàÜÁ±ªÔºü', message, async () => {
                try {
                    const response = await API.categories.delete(categoryId);
                    if (response.success) {
                        showToast('ÂàÜÁ±ªÂ∑≤Âà†Èô§', 'success');
                        
                        // Â¶ÇÊûúÂΩìÂâçÊ≠£Âú®Êü•ÁúãË¢´Âà†Èô§ÁöÑÂàÜÁ±ªÔºåÂàáÊç¢Âà∞ÂÖ®ÈÉ®
                        if (currentCategory === categoryId.toString()) {
                            currentCategory = 'all';
                        }
                        
                        await renderCategories();
                        await renderBookmarks();
                    } else {
                        showToast(response.message || 'Âà†Èô§Â§±Ë¥•', 'error');
                    }
                } catch (error) {
                    console.error('Âà†Èô§ÂàÜÁ±ªÂ§±Ë¥•:', error);
                    showToast('ÁΩëÁªúÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï', 'error');
                }
            });
        }

        // ÂàÜÁ±ªÂºπÁ™ó‰∫ã‰ª∂ÁªëÂÆö
        $('#addCategoryBtn').addEventListener('click', showAddCategoryModal);
        $('#categoryModalClose').addEventListener('click', () => closeModal(categoryModal));
        $('#categoryCancelBtn').addEventListener('click', () => closeModal(categoryModal));
        $('#categorySaveBtn').addEventListener('click', saveCategory);

        // ËæìÂÖ•Êó∂Ê∏ÖÈô§ÈîôËØØÁä∂ÊÄÅ
        $('#categoryName').addEventListener('input', () => {
            $('#categoryName').closest('.form-group').classList.remove('error');
        });

        // ========== Á°ÆËÆ§ÂºπÁ™ó ==========

        function showConfirmModal(title, message, callback, type = 'danger') {
            $('#confirmTitle').textContent = title;
            $('#confirmMessage').textContent = message;
            confirmCallback = callback;

            // ËÆæÁΩÆÂõæÊ†áÁ±ªÂûã
            const confirmIcon = $('#confirmIcon');
            confirmIcon.className = 'confirm-icon ' + type;

            // ËÆæÁΩÆÊåâÈíÆÊ†∑Âºè
            const okBtn = $('#confirmOkBtn');
            okBtn.className = 'btn btn-' + type;
            okBtn.textContent = type === 'danger' ? 'Âà†Èô§' : 'Á°ÆËÆ§';

            openModal(confirmModal);
        }

        $('#confirmCancelBtn').addEventListener('click', () => {
            closeModal(confirmModal);
            confirmCallback = null;
        });

        $('#confirmOkBtn').addEventListener('click', () => {
            closeModal(confirmModal);
            if (confirmCallback) {
                confirmCallback();
                confirmCallback = null;
            }
        });

        // ========================================
        // STEP 6: Êï∞ÊçÆÁÆ°ÁêÜ - ‰ΩøÁî®ÁúüÂÆûÂêéÁ´Ø API
        // ========================================
        // MockAPI Â∑≤Âú® js/api.js ‰∏≠ÂÆö‰πâÔºåÂÖºÂÆπÂéüÊúâÊé•Âè£
        // API ÂØπË±°Êèê‰æõ‰∫ÜÂÆåÊï¥ÁöÑÂêéÁ´ØÈÄö‰ø°ÂäüËÉΩ

        // Â∫îÁî®Áî®Êà∑ËÆæÁΩÆÔºà‰∏ªÈ¢òÂíåÈªòËÆ§ËßÜÂõæÔºâ
        async function applyUserSettings() {
            // ÂÖàÂ∞ùËØï‰ªéÂêéÁ´ØËé∑ÂèñËÆæÁΩÆ
            try {
                const response = await API.auth.getSettings();
                if (response.success && response.data) {
                    const { theme, defaultView } = response.data;
                    // ‰øùÂ≠òÂà∞Êú¨Âú∞‰ª•‰æøÂø´ÈÄüÂä†ËΩΩ
                    localStorage.setItem('userSettings', JSON.stringify(response.data));
                    applySettingsToUI(theme, defaultView);
                    return;
                }
            } catch (e) {
                console.log('‰ªéÂêéÁ´ØËé∑ÂèñËÆæÁΩÆÂ§±Ë¥•Ôºå‰ΩøÁî®Êú¨Âú∞ÁºìÂ≠ò');
            }
            
            // ÈôçÁ∫ß‰ΩøÁî®Êú¨Âú∞ÁºìÂ≠ò
            const settings = localStorage.getItem('userSettings');
            if (settings) {
                const { theme, defaultView } = JSON.parse(settings);
                applySettingsToUI(theme, defaultView);
            }
        }
        
        function applySettingsToUI(theme, defaultView) {
            // Â∫îÁî®‰∏ªÈ¢ò
            if (theme) {
                document.documentElement.setAttribute('data-theme', theme);
            }
            // Â∫îÁî®ÈªòËÆ§ËßÜÂõæ
            if (defaultView === 'list') {
                viewMode = 'list';
                $('#listViewBtn').classList.add('active');
                $('#gridViewBtn').classList.remove('active');
                $('#bookmarksGrid').classList.add('list-view');
            } else {
                viewMode = 'grid';
                $('#gridViewBtn').classList.add('active');
                $('#listViewBtn').classList.remove('active');
                $('#bookmarksGrid').classList.remove('list-view');
            }
        }

        // Âú®È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ
        window.addEventListener('DOMContentLoaded', async () => {
            // ÂÖàÂø´ÈÄüÂ∫îÁî®Êú¨Âú∞ÁºìÂ≠òÁöÑËÆæÁΩÆ
            const cachedSettings = localStorage.getItem('userSettings');
            if (cachedSettings) {
                const { theme, defaultView } = JSON.parse(cachedSettings);
                applySettingsToUI(theme, defaultView);
            }
            
            if (checkAuth()) {
                loadUserInfo();
                // ÂÖàÂä†ËΩΩÊâÄÊúâÊï∞ÊçÆÂà∞ÁºìÂ≠ò
                await loadAllData();
                // ÂÜçÊ∏≤ÊüìÂàÜÁ±ªÂíå‰π¶Á≠æÔºàÊ≠§Êó∂ÁºìÂ≠òÊï∞ÊçÆÂ∑≤Â∞±Áª™ÔºåÊï∞ÈáèËÆ°ÁÆóÊ≠£Á°ÆÔºâ
                renderCategoriesFromCache();
                renderBookmarksFromCache();
                // ÂºÇÊ≠•Âä†ËΩΩÂêéÁ´ØËÆæÁΩÆ
                applyUserSettings();
            }
        });

    </script>
</body>
</html>
