# 🎭 人脸签到考勤系统 - 项目思路文档

## 🎯 项目主题

**人脸签到考勤系统（Face Attendance System）**

一个基于人脸识别的考勤打卡系统，支持人脸注册、签到打卡、考勤记录查询，前后端分离架构，后端使用 Python FastAPI + OpenCV（Haar Cascade 人脸检测 + LBP 特征编码）。

---

## 📂 项目目录结构

```
人脸签到考勤系统/
├── 📄 项目思路文档.md          # 项目思路和设计文档
├── 📄 API接口文档.md           # 后端接口文档
│
├── 📂 frontend/                # 前端代码目录
│   ├── index.html             # 主页面（签到打卡）
│   ├── register.html          # 人脸注册页面
│   ├── records.html           # 考勤记录页面
│   ├── admin.html             # 管理后台（人员管理）
│   └── js/
│       └── api.js             # API 服务层
│
└── 📂 backend/                 # 后端代码目录 (Python FastAPI)
    ├── requirements.txt        # Python 依赖
    ├── start_server.bat        # Windows 启动脚本
    ├── app.py                  # FastAPI 主程序（包含所有API路由）
    ├── config.py               # 配置文件
    ├── database.py             # SQLite 数据库操作
    ├── face_service.py         # 人脸检测和识别服务
    │
    ├── 📂 data/                # 数据存储
    │   └── attendance.db       # SQLite 数据库文件
    │
    └── 📂 faces/               # 人脸照片存储
        └── {employee_id}.jpg   # 员工人脸照片
```

---

## 💡 为什么选择这个主题？

1. **AI技术入门** - 人脸识别是最直观的AI应用
2. **实用性强** - 考勤系统有真实使用场景
3. **技术栈新颖** - Python + FastAPI + face_recognition
4. **无需训练模型** - 使用预训练模型，降低难度
5. **可扩展性好** - 可添加活体检测、多人识别等功能

---

## 🏗️ 功能规划

### 核心功能（已完成 ✅）
- [x] 员工信息管理（添加、编辑、删除）
- [x] 人脸注册（摄像头拍照采集）
- [x] 人脸签到/签退打卡
- [x] 签到/签退记录存储

### 进阶功能（已完成 ✅）
- [x] 考勤记录查询（分页、筛选）
- [x] 按日期/员工/部门筛选
- [x] 考勤统计（今日应到、已签到、迟到、早退、缺勤）
- [x] 迟到/早退/缺勤状态标记
- [x] 分开记录签到状态和签退状态

### 待实现功能（第三阶段）
- [ ] 多人脸同时识别
- [ ] 活体检测（防照片攻击）
- [ ] 数据导出（Excel）
- [x] 考勤规则设置（上下班时间、容忍分钟数）

---

## 🔧 技术栈

| 层级 | 技术 | 说明 |
|------|------|------|
| 前端 | HTML + CSS + JavaScript | 原生实现，响应式设计 |
| 前端 | WebRTC | 调用摄像头拍照 |
| 后端 | Python 3.11 | 编程语言 |
| 后端 | FastAPI + Uvicorn | Web框架 + ASGI服务器 |
| 人脸检测 | OpenCV Haar Cascade | 人脸检测（haarcascade_frontalface_default） |
| 特征编码 | OpenCV LBP | 局部二值模式特征提取 |
| 人脸比对 | 余弦相似度 | 特征向量相似度计算 |
| 数据库 | SQLite | 轻量级数据库 |
| 其他 | uvicorn | ASGI服务器 |

---

## 🎨 页面设计

### 1. 首页 - 签到打卡（index.html）

```
┌─────────────────────────────────────────────────┐
│  🎭 人脸签到系统                    [记录] [管理] │
├─────────────────────────────────────────────────┤
│                                                 │
│         ┌─────────────────────┐                 │
│         │                     │                 │
│         │    📷 摄像头画面     │                 │
│         │                     │                 │
│         │   [人脸检测框]       │                 │
│         │                     │                 │
│         └─────────────────────┘                 │
│                                                 │
│              [ 🟢 签到 ]  [ 🔴 签退 ]             │
│                                                 │
│  ────────────────────────────────────────────── │
│  最近签到记录：                                   │
│  ✅ 张三 - 09:00:15 签到成功                      │
│  ✅ 李四 - 09:02:30 签到成功                      │
└─────────────────────────────────────────────────┘
```

### 2. 人脸注册页面（register.html）

```
┌─────────────────────────────────────────────────┐
│  🎭 人脸注册                          [返回首页]  │
├─────────────────────────────────────────────────┤
│                                                 │
│  员工信息：                                      │
│  ┌─────────────────────────────────────────┐    │
│  │ 工号：[________]  姓名：[________]        │    │
│  │ 部门：[________]  职位：[________]        │    │
│  └─────────────────────────────────────────┘    │
│                                                 │
│  人脸采集：                                      │
│         ┌─────────────────────┐                 │
│         │    📷 摄像头画面     │                 │
│         └─────────────────────┘                 │
│                                                 │
│         [ 📸 拍照采集 ] [ 📁 上传照片 ]           │
│                                                 │
│  已采集: 3/5 张                                  │
│  [照片1] [照片2] [照片3] [  ] [  ]              │
│                                                 │
│              [ ✅ 完成注册 ]                      │
└─────────────────────────────────────────────────┘
```

### 3. 考勤记录页面（records.html）

```
┌─────────────────────────────────────────────────┐
│  📋 考勤记录                          [返回首页]  │
├─────────────────────────────────────────────────┤
│                                                 │
│  筛选：日期 [2026-01-09 ▼]  员工 [全部 ▼]  [搜索] │
│                                                 │
│  ┌─────────────────────────────────────────┐    │
│  │ 工号   姓名   签到时间   签退时间   状态   │    │
│  ├─────────────────────────────────────────┤    │
│  │ 001   张三   09:00:15   18:05:20   正常   │    │
│  │ 002   李四   09:15:30   18:00:10   迟到   │    │
│  │ 003   王五   08:55:00     --      未签退  │    │
│  └─────────────────────────────────────────┘    │
│                                                 │
│  统计：今日签到 25人 / 应到 30人  出勤率 83.3%    │
│                                                 │
│              [ 📥 导出Excel ]                    │
└─────────────────────────────────────────────────┘
```

---

## 🔄 核心流程

### 人脸注册流程

```
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│ 填写信息  │ -> │ 拍照采集  │ -> │ 检测人脸  │ -> │ 提取特征  │
│ (工号姓名)│    │ (多张照片)│    │ (是否有效)│    │ (128维向量)│
└──────────┘    └──────────┘    └──────────┘    └──────────┘
                                                      │
                                                      ▼
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│ 注册成功  │ <- │ 保存数据  │ <- │ 特征存库  │ <- │ 计算平均  │
│ (可以签到)│    │ (员工+人脸)│    │ (向量存储)│    │ (多张合成)│
└──────────┘    └──────────┘    └──────────┘    └──────────┘
```

### 人脸签到流程

```
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│ 打开摄像头 │ -> │ 实时检测  │ -> │ 检测到人脸 │ -> │ 提取特征  │
│          │    │ 人脸位置   │    │ 截取人脸   │    │ (128维向量)│
└──────────┘    └──────────┘    └──────────┘    └──────────┘
                                                      │
                                                      ▼
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│ 签到成功  │ <- │ 记录考勤  │ <- │ 识别成功  │ <- │ 比对特征  │
│ 显示姓名  │    │ (存入数据库)│    │ (张三)    │    │ (遍历人脸库)│
└──────────┘    └──────────┘    └──────────┘    └──────────┘
```

---

## 📦 数据库设计

### employees 表（员工信息）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键ID |
| employee_id | TEXT | 工号（唯一） |
| name | TEXT | 姓名 |
| department | TEXT | 部门 |
| position | TEXT | 职位 |
| face_encoding | BLOB | 人脸特征向量（128维） |
| face_image | TEXT | 人脸照片路径 |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

### attendance 表（考勤记录）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键ID |
| employee_id | TEXT | 工号（外键） |
| date | DATE | 日期 |
| check_in_time | DATETIME | 签到时间 |
| check_out_time | DATETIME | 签退时间 |
| status | TEXT | 状态（正常/迟到/早退/缺勤） |
| check_in_image | TEXT | 签到截图路径 |
| created_at | DATETIME | 创建时间 |

### settings 表（系统设置）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键ID |
| key | TEXT | 设置项名称 |
| value | TEXT | 设置值 |

---

## ⚙️ 配置项

```python
# config.py

# 人脸识别配置
FACE_RECOGNITION_TOLERANCE = 0.5  # 识别阈值（越小越严格）
MIN_FACE_SIZE = 50                # 最小人脸尺寸（像素）
FACE_SAMPLES_COUNT = 5            # 注册时采集人脸数量

# 考勤规则
WORK_START_TIME = "09:00"         # 上班时间
WORK_END_TIME = "18:00"           # 下班时间
LATE_THRESHOLD_MINUTES = 10       # 迟到阈值（分钟）
EARLY_THRESHOLD_MINUTES = 10      # 早退阈值（分钟）

# 文件存储
UPLOAD_DIR = "uploads/faces"      # 人脸照片存储目录

# 数据库
DATABASE_PATH = "database/attendance.db"
```

---

## 🚀 快速开始

### 1. 安装依赖

```bash
cd backend
pip install -r requirements.txt
```

### 2. 启动后端

```bash
python -m uvicorn app:app --reload --host 0.0.0.0 --port 8081
```

### 3. 打开前端

用浏览器打开 `frontend/index.html`

---

## 📝 注意事项

1. **摄像头权限** - 需要浏览器允许访问摄像头
2. **光线要求** - 良好的光线条件有助于提高识别率
3. **人脸角度** - 建议正面拍摄，避免侧脸
4. **照片质量** - 注册时建议采集多张不同表情的照片
5. **隐私保护** - 人脸数据仅存储在本地，不上传云端

---

## 🔮 扩展功能（可选）

1. **活体检测** - 防止照片欺骗
2. **多摄像头支持** - 多个签到点
3. **人脸质量评估** - 自动筛选高质量人脸
4. **异常告警** - 陌生人检测
5. **移动端适配** - 手机签到
6. **考勤报表** - 月度统计报表

---

## 📚 参考资料

- [face_recognition 文档](https://github.com/ageitgey/face_recognition)
- [FastAPI 官方文档](https://fastapi.tiangolo.com/)
- [OpenCV Python 教程](https://docs.opencv.org/master/d6/d00/tutorial_py_root.html)
